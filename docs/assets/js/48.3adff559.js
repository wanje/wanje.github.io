(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{477:function(t,s,a){"use strict";a.r(s);var n=a(18),r=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"rollup使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rollup使用"}},[t._v("#")]),t._v(" Rollup使用")]),t._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#安装与基本命令"}},[t._v("安装与基本命令")])]),a("li",[a("a",{attrs:{href:"#插件及用处"}},[t._v("插件及用处")])]),a("li",[a("a",{attrs:{href:"#babel及polyfill"}},[t._v("babel及polyfill")]),a("ul",[a("li",[a("a",{attrs:{href:"#对于业务开发"}},[t._v("对于业务开发")])]),a("li",[a("a",{attrs:{href:"#对于库开发"}},[t._v("对于库开发")])])])]),a("li",[a("a",{attrs:{href:"#rollup-config-js配置文件"}},[t._v("rollup.config.js配置文件")])]),a("li",[a("a",{attrs:{href:"#package-json文件参考"}},[t._v("package.json文件参考")])])])]),a("p"),t._v(" "),a("p",[a("a",{attrs:{href:"https://cn.rollupjs.org/tutorial/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Rollup官方中文文档"),a("OutboundLink")],1),t._v("，当前笔记中的 rollup 为 V3 版本。")]),t._v(" "),a("h2",{attrs:{id:"安装与基本命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装与基本命令"}},[t._v("#")]),t._v(" 安装与基本命令")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 若设备上未安装过 rollup，则初始全局安装（推荐），安装后即可使用`rollup`指令，之后就不用再安装")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" rollup -g\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 若不全局安装，而只针对当前项目，则可以本地安装为开发依赖，此时可以通过`npx rollup`或`yarn rollup`来使用`rollup`指令")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" rollup -D\n\n "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 帮助命令查看")]),t._v("\nrollup --help\nrollup -h\nrollup\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# rollup 默认用命令行模式指定相关参数来运行，若要使用配置文件，则需要通过`--config`或`-c`标志指明配置文件")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 为方便使用和平时的开发习惯，可以将其配置到 package.json 文件的 scripts 脚本命令中")]),t._v("\nrollup --config my.config.js\nrollup -c                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 不指定配置文件时将默认查找`rollup.config.mjs|.cjs|.js`文件")]),t._v("\n")])])]),a("h2",{attrs:{id:"插件及用处"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#插件及用处"}},[t._v("#")]),t._v(" 插件及用处")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/rollup/awesome",target:"_blank",rel:"noopener noreferrer"}},[t._v("Rollup插件汇总"),a("OutboundLink")],1),t._v("，这些应该都是作为开发依赖进行安装，因为开发出的库本身并不需要包含这些rollup插件内容。")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("@rollup/plugin-babel")]),t._v("，babel转换一些新特性为ES5语法\n"),a("ul",[a("li",[t._v("需要预先安装"),a("code",[t._v("@babel/core")]),t._v("和"),a("code",[t._v("@babel/preset-env")]),t._v("才能使用")]),t._v(" "),a("li",[t._v("创建配置文件，有两种模式的配置文件，一种全局应用"),a("code",[t._v("babel.config.js")]),t._v("(项目根目录)，一种局部应用"),a("code",[t._v(".babelrc.json")]),t._v("(放置位置内的所有内容及子内容，因此可以在不同位置放置以覆盖上层配置)")]),t._v(" "),a("li",[a("code",[t._v("babel.config.js")]),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// 这里使用的原生ES模块语法，故需要在package.json中添加"type": "module"字段，或者换成.mjs文件')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  presets"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@babel/env"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),a("li",[a("code",[t._v(".babelrc.json")]),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"presets"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@babel/env"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])])]),t._v(" "),a("li",[a("code",[t._v("@rollup/plugin-terser")]),t._v("，压缩打包输出物")]),t._v(" "),a("li",[a("code",[t._v("@rollup/plugin-json")]),t._v("，允许从 JSON 文件中直接import导入数据，将 JSON 文件数据当做JS导出的一个默认数据对象")]),t._v(" "),a("li",[a("code",[t._v("@rollup/plugin-node-resolve")]),t._v("，可以使 rollup 找到安装的"),a("code",[t._v("node_modules")]),t._v("外部依赖模块（rollup本身不像Webpack会自动去找）")]),t._v(" "),a("li",[a("code",[t._v("@rollup/plugin-commonjs")]),t._v("，将CommonJS模块的npm包转换为ES模块形式供rollup使用，因为rollup使用ES6原生方式处理模块，而当前npm上大多数包都还是CommonJS模块形式\n"),a("ul",[a("li",[t._v("大多情况下，"),a("strong",[t._v("该插件应该放在转换模块的其他插件之前")]),t._v("，以防止其他模块转换插件 "),a("strong",[t._v("(非模块转换的插件无影响)")]),t._v(" 对 CommonJS 检测产生影响")]),t._v(" "),a("li",[t._v("Babel 插件虽然也会转换模块，但其是对语法的支持转换，所以仍然要放在"),a("code",[t._v("@rollup/plugin-commonjs")]),t._v("插件之前")])])]),t._v(" "),a("li",[a("code",[t._v("rollup-plugin-filesize")]),t._v("，可在控制台显示打包输出文件大小")])]),t._v(" "),a("p",[a("code",[t._v("import.meta.url")]),t._v("返回当前模块文件本身的绝对路径。")]),t._v(" "),a("p",[t._v("在 CommonJS 下的 node 中经常使用"),a("code",[t._v("__dirname")]),t._v("来访问当前目录并将相对路径解析成绝对路径，而这在原生ES模板中年不支持，可以通过如下方式来处理：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// node:xxx 表示 node 中 xxx 模块")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" fileURLToPath "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'node:url'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 返回指定文件的绝对路径")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" createRequire "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'node:module'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" path "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'node:path'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 自定义 require 方法，可用于加载 json 文件")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" require "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createRequire")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("meta"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// import.meta.url 就是当前文件的绝对路径，new URL(文件url, 相对参考位置) 得到一个文件url路径对象")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" curUrl "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("URL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("meta"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" __dirname "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fileURLToPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("curUrl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'URL对象'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" curUrl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'当前模块路径'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" __dirname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'入口文件绝对路径：'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fileURLToPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("URL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'src/index.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("meta"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 定义式 resolve 方法，可返回传入的相对当前目录位置(__dirname)的 p 路径的绝对路径")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("resolve")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("p")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" p"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h2",{attrs:{id:"babel及polyfill"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#babel及polyfill"}},[t._v("#")]),t._v(" babel及polyfill")]),t._v(" "),a("p",[t._v("ES6+相较于ES5的三个概念：")]),t._v(" "),a("ul",[a("li",[t._v("新语法，如：箭头函数、字符串模板、"),a("code",[t._v("let/const")]),t._v("等")]),t._v(" "),a("li",[t._v("新API，如："),a("code",[t._v("Promise")]),t._v("等")]),t._v(" "),a("li",[t._v("新实例/静态方法，如："),a("code",[t._v("String.prototype.include")]),t._v("、"),a("code",[t._v("Array.from")]),t._v("等")])]),t._v(" "),a("p",[t._v("对于语法的转换只是写法上的变化，而一些较新的API或方法，需要有polyfill垫片实现（也即是使用ES5去实现ES6+的这些API或方法）才可使用，babel提供插入polyfill的方式有多种，但大致分为两类：")]),t._v(" "),a("ul",[a("li",[t._v("全局导入，可全量也可根据需要导入部分，原理是将实现的polyfill直接声明在与新API/方法同名的全局变量上，或是相应对象原型链上，该方式因为是直接按照原本API应该有的样子去在全局变量上实现的（如"),a("code",[t._v("Array.prototype.find=function(){...}")]),t._v("），所以会污染全局变量，参与开发的人员都可以去覆盖重写（不排除一开始某些方法已被开发人员重写，而造成错误）")]),t._v(" "),a("li",[t._v("内部转换，根据需要打包工具扫描源码中用到的相应ES6+ API/方法替换为调用babel提供的同功能方法（也即是输出结果一样，但是并非一样的用法，比如："),a("code",[t._v("arr.find(cb)")]),t._v("被转换为"),a("code",[t._v("_find(arr, cb)")]),t._v("，这里"),a("code",[t._v("_find")]),t._v("方法就是babel转换后的"),a("code",[t._v("find")]),t._v("方法的局部实现，它们输出同样的结果），因为所有内容都在局部作用域中被转换，故不会污染全局变量，但该方式可能会造成同一功能在多个局部作用域被重复转换而增加包体积（结合打包工具提供的能力也可将这些公共内容抽离出来以得到改善）")])]),t._v(" "),a("h3",{attrs:{id:"对于业务开发"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#对于业务开发"}},[t._v("#")]),t._v(" 对于业务开发")]),t._v(" "),a("p",[t._v("推荐全局导入")]),t._v(" "),a("h3",{attrs:{id:"对于库开发"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#对于库开发"}},[t._v("#")]),t._v(" 对于库开发")]),t._v(" "),a("p",[t._v("推荐内部转换")]),t._v(" "),a("h2",{attrs:{id:"rollup-config-js配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rollup-config-js配置文件"}},[t._v("#")]),t._v(" rollup.config.js配置文件")]),t._v(" "),a("p",[t._v("该配置文件若使用"),a("code",[t._v(".js")]),t._v("文件则需要在"),a("code",[t._v("package.json")]),t._v("中添加"),a("code",[t._v('"type": "module"')]),t._v("字段，或者换成"),a("code",[t._v(".mjs")]),t._v("文件，又或者在命令行参数中添加"),a("code",[t._v("--bundleConfigAsCjs")]),t._v("(内容需要按CommonJS模式写，或直接用"),a("code",[t._v(".cjs")]),t._v("文件)，因为打包时 node 默认会按照 CommonJS 模式加载配置文件，而这里文件内容实际是按照 ES 模块写的，打包加载时就会报错。")]),t._v(" "),a("p",[t._v("详细配置选项可参考"),a("a",{attrs:{href:"https://cn.rollupjs.org/configuration-options/",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方中文文档"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("p",[t._v("注意这里使用的是原生 ES 模块导入导出，而非 CommonJS 模块规范，故需要注意不能用"),a("code",[t._v("require")]),t._v("导入，而要使用"),a("code",[t._v("import")]),t._v("，若要使用node的CommonJS规范则需要将"),a("code",[t._v(".js")]),t._v("文件换成"),a("code",[t._v(".cjs")]),t._v("后缀（此时就可以使用node中的"),a("code",[t._v("require")]),t._v("和"),a("code",[t._v("module.exports")]),t._v("等）。")]),t._v(" "),a("p",[t._v("rollup支持输出的文件规范(除"),a("code",[t._v("cmd")]),t._v(")：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("iife")]),t._v("，立即执行函数，适用于浏览器 script 直接引入")]),t._v(" "),a("li",[a("code",[t._v("cjs")]),t._v("，别名"),a("code",[t._v("commonjs")]),t._v("，CommonJS规范，适用于 nodejs")]),t._v(" "),a("li",[a("code",[t._v("amd")]),t._v("，适用于 RequireJs 模块化导入")]),t._v(" "),a("li",[a("code",[t._v("umd")]),t._v("，集合 AMD/CMD/CommonJS/iife，可同时用于浏览器 script 直接引入、RequireJs/SeaJS 模块化导入、nodejs，但这里的umd模式输出未包含CMD")]),t._v(" "),a("li",[a("code",[t._v("es")]),t._v("，别名"),a("code",[t._v("esm")]),t._v("或"),a("code",[t._v("module")]),t._v("，ES6 原生模块化，需原生支持"),a("code",[t._v("import/export")]),t._v("语法，rollup输出的默认模式")]),t._v(" "),a("li",[a("code",[t._v("system")]),t._v("，别名"),a("code",[t._v("systemjs")]),t._v("，适用于 SystemJS 模块加载器")])]),t._v(" "),a("p",[t._v("另外，前端中还有"),a("code",[t._v("CMD")]),t._v("规范，适用于 SeaJS 模块化导入，但较少使用，rollup中并不包含该模式的输出。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" babel "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@rollup/plugin-babel'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" resolve "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@rollup/plugin-node-resolve'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" commonjs "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@rollup/plugin-commonjs'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" json "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@rollup/plugin-json'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" terser "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@rollup/plugin-terser'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" filesize "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'rollup-plugin-filesize'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 也可以导出一个数组，用于从多个不相关的输入分别进行打包")]),t._v("\n\tinput"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'src/index.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 入口文件，可以是一个数组或对象以配置多个入口")]),t._v("\n\toutput"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 可以是数组，用于输出多个类型的结果")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// dir: 'dist', // 当需要使用代码分割功能时需要用 dir 指定输出目录位置，而不是 file，主要是输出的库要做动态加载(按需加载)或有多个入口点输出多个文件时用到")]),t._v("\n\t\tfile"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dist/watermark.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 输出文件位置及名字")]),t._v("\n\t\tformat"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'umd'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 打包输出规范格式：iife、cjs、amd、umd、system，默认 es")]),t._v("\n\t\tname"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'watermark'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 导出库/插件的全局变量名，当输出 iife、umd 格式供浏览器 script 引入时，需要有一个全局变量暴露导出的内容给外部使用")]),t._v("\n    sourcemap"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 为 true 时将生成一个独立的 sourcemap 文件，为 hidden 时同 true，但打包文件末尾没有 sourcemap 的注释(此时无法自动映射到源码)")]),t._v("\n\t\tglobals"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 用于在 umd/iife 模式的输出中指出外部依赖对应的全局变量（键值对形式，依赖包名：全局变量名），结合 external 选项使用")]),t._v("\n      jquery"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 这里就表示当前产物依赖一个 jquery 外部包，其提供的全局变量为 $，这样打包输出中就会注入该变量")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\tplugins"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 对输出物进行处理的插件，这部分插件只能在 Rollup 的主要分析完成后修改代码（相当于是对rollup的产出继续处理）")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("terser")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    watch"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 观察配置，以便相关文件变动就重新打包")]),t._v("\n      include"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'src/**'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 指定观察哪些文件，格式支持字符串(含通配符)、正则、数组")]),t._v("\n      exclude"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'node_modules/**'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 不需要观察的文件，格式同上")]),t._v("\n      buildDelay"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 观察到变动后延迟多少毫秒才开始重新构建")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  external"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'jquery'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 外部导入的模块名(或正则匹配)，模块名即是from后的内容(必须一致)，此时对应模块不会打包进我们开发的库中，格式为数组或函数")]),t._v("\n\tplugins"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// rollup插件配置")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("json")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("babel")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("commonjs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("filesize")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h2",{attrs:{id:"package-json文件参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#package-json文件参考"}},[t._v("#")]),t._v(" package.json文件参考")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"watermark"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"version"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.0.0"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"description"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Add watermarks to web pages and try to make it impossible to remove or hide them through developer tool debugging."')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"main"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./dist/watermark.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"type"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"module"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"scripts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"build"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rollup -c"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"keywords"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"watermark"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"canvas"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"author"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wanje"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"license"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MIT"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"dependencies"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"@babel/runtime-corejs3"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^7.22.15"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"devDependencies"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"@babel/core"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^7.22.17"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"@babel/plugin-transform-runtime"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^7.22.15"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"@babel/preset-env"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^7.22.15"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"@rollup/plugin-babel"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^6.0.3"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"@rollup/plugin-commonjs"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^25.0.4"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"@rollup/plugin-json"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^6.0.0"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"@rollup/plugin-node-resolve"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^15.2.1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"@rollup/plugin-terser"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^0.4.3"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"rollup-plugin-filesize"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^10.0.0"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"browserslist"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"> 0.5%, ie >= 11"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=r.exports}}]);