<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Node模块机制与NPM包 | Notebook</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/docs/favicon.ico">
    <meta name="description" content="个人学习记录，资料收集备忘">
    
    <link rel="preload" href="/docs/assets/css/0.styles.06c719a7.css" as="style"><link rel="preload" href="/docs/assets/js/app.744a69eb.js" as="script"><link rel="preload" href="/docs/assets/js/2.23b2ce06.js" as="script"><link rel="preload" href="/docs/assets/js/44.142c8386.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.7cb63053.js"><link rel="prefetch" href="/docs/assets/js/11.0c9a6245.js"><link rel="prefetch" href="/docs/assets/js/12.1ea393cb.js"><link rel="prefetch" href="/docs/assets/js/13.16917c5a.js"><link rel="prefetch" href="/docs/assets/js/14.c9e1db24.js"><link rel="prefetch" href="/docs/assets/js/15.30292023.js"><link rel="prefetch" href="/docs/assets/js/16.e0c75262.js"><link rel="prefetch" href="/docs/assets/js/17.d7042320.js"><link rel="prefetch" href="/docs/assets/js/18.c1e16f26.js"><link rel="prefetch" href="/docs/assets/js/19.c9501643.js"><link rel="prefetch" href="/docs/assets/js/20.9604abef.js"><link rel="prefetch" href="/docs/assets/js/21.9ca2d0a3.js"><link rel="prefetch" href="/docs/assets/js/22.5ee54a9c.js"><link rel="prefetch" href="/docs/assets/js/23.edf8dcc1.js"><link rel="prefetch" href="/docs/assets/js/24.7b62a902.js"><link rel="prefetch" href="/docs/assets/js/25.9c47d47c.js"><link rel="prefetch" href="/docs/assets/js/26.9b603f7f.js"><link rel="prefetch" href="/docs/assets/js/27.4ecc52db.js"><link rel="prefetch" href="/docs/assets/js/28.3b7abfca.js"><link rel="prefetch" href="/docs/assets/js/29.0fe87892.js"><link rel="prefetch" href="/docs/assets/js/3.405f8ddb.js"><link rel="prefetch" href="/docs/assets/js/30.e6009561.js"><link rel="prefetch" href="/docs/assets/js/31.ce18284d.js"><link rel="prefetch" href="/docs/assets/js/32.521f68ec.js"><link rel="prefetch" href="/docs/assets/js/33.52bb8ba5.js"><link rel="prefetch" href="/docs/assets/js/34.9baf7f43.js"><link rel="prefetch" href="/docs/assets/js/35.e3ec2fec.js"><link rel="prefetch" href="/docs/assets/js/36.c0342d0b.js"><link rel="prefetch" href="/docs/assets/js/37.c38abfcd.js"><link rel="prefetch" href="/docs/assets/js/38.3afaed3d.js"><link rel="prefetch" href="/docs/assets/js/39.9ae91714.js"><link rel="prefetch" href="/docs/assets/js/4.74c60e58.js"><link rel="prefetch" href="/docs/assets/js/40.c15edce9.js"><link rel="prefetch" href="/docs/assets/js/41.626f7909.js"><link rel="prefetch" href="/docs/assets/js/42.f98c1259.js"><link rel="prefetch" href="/docs/assets/js/43.d3df4473.js"><link rel="prefetch" href="/docs/assets/js/45.84f2778f.js"><link rel="prefetch" href="/docs/assets/js/46.e2e3246c.js"><link rel="prefetch" href="/docs/assets/js/47.948ed66e.js"><link rel="prefetch" href="/docs/assets/js/48.08bc9bbe.js"><link rel="prefetch" href="/docs/assets/js/49.0d219424.js"><link rel="prefetch" href="/docs/assets/js/5.8f4e575b.js"><link rel="prefetch" href="/docs/assets/js/50.8bf523bb.js"><link rel="prefetch" href="/docs/assets/js/51.227d3165.js"><link rel="prefetch" href="/docs/assets/js/52.cdf47fbc.js"><link rel="prefetch" href="/docs/assets/js/53.d4abc0f3.js"><link rel="prefetch" href="/docs/assets/js/54.6fa4e46d.js"><link rel="prefetch" href="/docs/assets/js/55.c15108f4.js"><link rel="prefetch" href="/docs/assets/js/56.5c7c699a.js"><link rel="prefetch" href="/docs/assets/js/57.5436677e.js"><link rel="prefetch" href="/docs/assets/js/58.240ea1de.js"><link rel="prefetch" href="/docs/assets/js/59.a5bbbaa8.js"><link rel="prefetch" href="/docs/assets/js/6.2757e850.js"><link rel="prefetch" href="/docs/assets/js/60.27ffc0ae.js"><link rel="prefetch" href="/docs/assets/js/61.a4988bba.js"><link rel="prefetch" href="/docs/assets/js/62.beb94abf.js"><link rel="prefetch" href="/docs/assets/js/63.cec4b0ff.js"><link rel="prefetch" href="/docs/assets/js/64.9c15a355.js"><link rel="prefetch" href="/docs/assets/js/65.e3f95e93.js"><link rel="prefetch" href="/docs/assets/js/66.0d331a27.js"><link rel="prefetch" href="/docs/assets/js/67.0ea21813.js"><link rel="prefetch" href="/docs/assets/js/68.1c70f1f3.js"><link rel="prefetch" href="/docs/assets/js/69.8f2327aa.js"><link rel="prefetch" href="/docs/assets/js/7.d1d65966.js"><link rel="prefetch" href="/docs/assets/js/70.feef7ee9.js"><link rel="prefetch" href="/docs/assets/js/71.6b2b70c3.js"><link rel="prefetch" href="/docs/assets/js/72.a3b33081.js"><link rel="prefetch" href="/docs/assets/js/73.3892d802.js"><link rel="prefetch" href="/docs/assets/js/74.95722518.js"><link rel="prefetch" href="/docs/assets/js/75.0d66bf36.js"><link rel="prefetch" href="/docs/assets/js/76.0f5471bc.js"><link rel="prefetch" href="/docs/assets/js/77.c01f743e.js"><link rel="prefetch" href="/docs/assets/js/78.2e913b4a.js"><link rel="prefetch" href="/docs/assets/js/79.1ee3497a.js"><link rel="prefetch" href="/docs/assets/js/8.d9a953aa.js"><link rel="prefetch" href="/docs/assets/js/80.1625b7e2.js"><link rel="prefetch" href="/docs/assets/js/81.78b73f22.js"><link rel="prefetch" href="/docs/assets/js/9.ec20bfe0.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.06c719a7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><img src="/docs/logo.png" alt="Notebook" class="logo"> <span class="site-name can-hide">Notebook</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="笔记分类" class="dropdown-title"><span class="title">笔记分类</span> <span class="arrow down"></span></button> <button type="button" aria-label="笔记分类" class="mobile-dropdown-title"><span class="title">笔记分类</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/js/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/docs/html/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/docs/css/" class="nav-link">
  CSS
</a></li></ul></div></div><div class="nav-item"><a href="https://wanje.github.io/demo_notes/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  更多
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="笔记分类" class="dropdown-title"><span class="title">笔记分类</span> <span class="arrow down"></span></button> <button type="button" aria-label="笔记分类" class="mobile-dropdown-title"><span class="title">笔记分类</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/js/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/docs/html/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/docs/css/" class="nav-link">
  CSS
</a></li></ul></div></div><div class="nav-item"><a href="https://wanje.github.io/demo_notes/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  更多
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>HTML</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/html/HTML零散集.html" class="sidebar-link">HTML零散集</a></li><li><a href="/docs/html/a标签的各种用途.html" class="sidebar-link">a标签的各种用途</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JavaScript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/js/JS错题本.html" class="sidebar-link">JS错题本</a></li><li><a href="/docs/js/JS零散集.html" class="sidebar-link">JS零散集</a></li><li><a href="/docs/js/数组Array.html" class="sidebar-link">数组Array</a></li><li><a href="/docs/js/字符串String.html" class="sidebar-link">字符串String</a></li><li><a href="/docs/js/计算Math.html" class="sidebar-link">计算Math</a></li><li><a href="/docs/js/事件Event.html" class="sidebar-link">事件Event</a></li><li><a href="/docs/js/WebComponents.html" class="sidebar-link">Web Components</a></li><li><a href="/docs/js/Lit创建WebComponents.html" class="sidebar-link">Lit 框架创建 Web Components</a></li><li><a href="/docs/js/File文件API.html" class="sidebar-link">File文件API</a></li><li><a href="/docs/js/鼠标拖放与拖拽dnd.html" class="sidebar-link">鼠标拖拽与拖放</a></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>ES6+</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/js/es6+/Class.html" class="sidebar-link">Class</a></li><li><a href="/docs/js/es6+/Promise.html" class="sidebar-link">Promise</a></li><li><a href="/docs/js/es6+/async-await.html" class="sidebar-link">async/await</a></li><li><a href="/docs/js/es6+/Proxy.html" class="sidebar-link">Proxy</a></li><li><a href="/docs/js/es6+/Reflect.html" class="sidebar-link">Reflect</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>CSS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/css/CSS零散集.html" class="sidebar-link">CSS零散集</a></li><li><a href="/docs/css/scss语法.html" class="sidebar-link">SCSS基础语法</a></li><li><a href="/docs/css/CSS选择器世界.html" class="sidebar-link">CSS选择器世界</a></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>CSS世界</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/css/CSS世界/层叠规则.html" class="sidebar-link">层叠规则</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>CSS新世界</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/css/CSS新世界/第6章.html" class="sidebar-link">第 6 章 全新的布局方式</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>绘图&amp;动画</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/draw-animation/D3js.html" class="sidebar-link">D3.js</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Threejs开发指南</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Vue</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/vue/vue工程配置.html" class="sidebar-link">Vue工程创建及配置</a></li><li><a href="/docs/vue/vue基础语法.html" class="sidebar-link">Vue基础语法</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>React</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/react/react工程配置.html" class="sidebar-link">React工程创建及配置</a></li><li><a href="/docs/react/react基础语法.html" class="sidebar-link">React基础语法</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>TypeScript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/typescript/类型/为什么需要类型.html" class="sidebar-link">为什么需要类型</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>类型</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>泛型</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>类型转换</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/docs/typescript/模块/CommonJS兼容模块.html" class="sidebar-link">CommonJS兼容模块</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>命名空间</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>理解声明</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Node</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/node/Node模块机制.html" class="active sidebar-link">Node模块机制与NPM包</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/node/Node模块机制.html#commonjs规范下的node模块" class="sidebar-link">CommonJS规范下的Node模块</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/node/Node模块机制.html#模块编译" class="sidebar-link">模块编译</a></li><li class="sidebar-sub-header"><a href="/docs/node/Node模块机制.html#模块定义" class="sidebar-link">模块定义</a></li><li class="sidebar-sub-header"><a href="/docs/node/Node模块机制.html#模块引用" class="sidebar-link">模块引用</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/node/Node模块机制.html#包与npm" class="sidebar-link">包与NPM</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/node/Node模块机制.html#包的基本构成" class="sidebar-link">包的基本构成</a></li><li class="sidebar-sub-header"><a href="/docs/node/Node模块机制.html#包的安装" class="sidebar-link">包的安装</a></li><li class="sidebar-sub-header"><a href="/docs/node/Node模块机制.html#包的编写发布流程" class="sidebar-link">包的编写发布流程</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/node/Node模块机制.html#指定项目node版本依赖" class="sidebar-link">指定项目node版本依赖</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Webpack</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/webpack/webpack4.x笔记.html" class="sidebar-link">webpack4.x笔记</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Python</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/python/python基础语法.html" class="sidebar-link">Python基础语法</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>其他</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/others/参考内容.html" class="sidebar-link">参考内容</a></li><li><a href="/docs/others/lint-format.html" class="sidebar-link">代码检查与格式化</a></li><li><a href="/docs/others/Markdown语法.html" class="sidebar-link">Markdown语法</a></li><li><a href="/docs/others/Git使用.html" class="sidebar-link">Git使用</a></li><li><a href="/docs/others/Gulp使用.html" class="sidebar-link">Gulp使用</a></li><li><a href="/docs/others/Rollup使用.html" class="sidebar-link">Rollup使用</a></li><li><a href="/docs/others/Nginx配置.html" class="sidebar-link">Nginx基础配置与操作</a></li><li><a href="/docs/others/环境&amp;软件安装.html" class="sidebar-link">环境&amp;软件安装</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="node模块机制与npm包"><a href="#node模块机制与npm包" class="header-anchor">#</a> Node模块机制与NPM包</h1> <p></p><div class="table-of-contents"><ul><li><a href="#commonjs规范下的node模块">CommonJS规范下的Node模块</a><ul><li><a href="#模块编译">模块编译</a></li><li><a href="#模块定义">模块定义</a></li><li><a href="#模块引用">模块引用</a></li></ul></li><li><a href="#包与npm">包与NPM</a><ul><li><a href="#包的基本构成">包的基本构成</a></li><li><a href="#包的安装">包的安装</a></li><li><a href="#包的编写发布流程">包的编写发布流程</a></li></ul></li><li><a href="#指定项目node版本依赖">指定项目node版本依赖</a></li></ul></div><p></p> <h2 id="commonjs规范下的node模块"><a href="#commonjs规范下的node模块" class="header-anchor">#</a> CommonJS规范下的Node模块</h2> <h3 id="模块编译"><a href="#模块编译" class="header-anchor">#</a> 模块编译</h3> <p>Node在编译获取的JS文件内容时，对文件内容进行了如下的头尾包装，所以才使得每个模块文件中未定义<code>require</code>、<code>exports</code>、<code>module</code>、<code>__filename</code>、<code>__dirname</code>这几个变量，却能直接使用。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">exports<span class="token punctuation">,</span> require<span class="token punctuation">,</span> module<span class="token punctuation">,</span> __filename<span class="token punctuation">,</span> __dirname</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// JS模块文件内容被放在这里...，使得模块文件中可以直接使用上面几个特殊变量</span>
  <span class="token comment">// 我们无需关注其具体如何编译，在模块文件中直接使用即可</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><code>exports</code>其实是module的属性也被单独传入可直接使用，但实际导出是反映在module.exports上的，所以一个个导出可使用exports，整体导出则要使用module.exports</li> <li><code>__filename</code>为当前模块文件的绝对路径</li> <li><code>__dirname</code>为当前模块文件所在目录的绝对路径</li></ul> <h3 id="模块定义"><a href="#模块定义" class="header-anchor">#</a> 模块定义</h3> <p>使用<code>exports</code>对象导出当前模块的方法或者变量，且<strong>exports是导出的唯一出口</strong>；在模块中，还存在一个<code>module</code>对象，它代表模块自身，而<code>exports</code>是<code>module</code>的属性（这与上面提到的node编译JS模块所做的头尾包装有关，<strong>包装时传入的exports就已经是module的属性</strong>）</p> <p>在node中，一个文件就是一个模块，将方法或变量挂载在<code>exports</code>对象上作为属性即可定义导出的方式。<br>
若要直接整体导出一个已包含全部要导出属性和方法的对象或者类，这时就可以直接对<code>module.exports</code>进行赋值导出该对象或类，因为最终的实际导出本就是要通过 <code>module.exports</code>反映。</p> <ul><li>我们在添加或修改<code>exports</code>上的属性时，<code>exports</code>对象的引用并未改变，故变化也能反映在<code>module.exports</code>上，从而可正确导出；</li> <li>但是若直接给<code>exports</code>进行赋值操作时，其引用就发生变化了，因为其实际是node传入的一个形参，形参改变引用并不能改变其原对应实参的引用，所以<code>module.exports</code>并不会变化，也就导致导出会失败；</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/* math.js */</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> require<span class="token punctuation">,</span> module<span class="token punctuation">,</span> __filename<span class="token punctuation">,</span> __dirname<span class="token punctuation">)</span> 
<span class="token comment">// module.exports = {props, methods};   //若要直接导出整个对象或类则就要赋值给 module.exports，而不是 exports</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> args <span class="token operator">=</span> arguments<span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>len<span class="token operator">=</span>args<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">&lt;</span>len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sum <span class="token operator">+=</span> args<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> sum<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="模块引用"><a href="#模块引用" class="header-anchor">#</a> 模块引用</h3> <p>使用 <code>require()</code>方法引入一个外部模块的API到当前上下文中，其参数为模块标识（就是模块文件，也可指定具体文件路径）。node对引入过的模块都会进行缓存，所以再次引入时会优先从缓存中加载，且node不像浏览器是缓存文件，其是缓存编译和执行之后的对象。</p> <p><strong>模块标识参数类型：</strong></p> <ol><li>符合小驼峰命名的字符串（引入的模块会从文件所在位置开始逐级向上查找node_modules文件夹，直到根目录（类似JS中的原型链查找），包括Node自身提供的核心模块和用户自定义模块，其中node核心模块加载时可省略文件定位和编译执行两个步骤，速度是最快的）</li> <li>以<code>./</code>、<code>../</code>开头的相对路径，或者绝对路径，此类模块为用户编写的文件模块；加载时需要<strong>路径分析、文件定位、编译执行</strong>几个过程</li></ol> <ul><li><strong>模块标识可以不加文件后缀</strong>，此时node会按.js、.json、.node三种扩展依次尝试加载，所以若是后两种文件可加上扩展名避免浪费性能，若是这三种扩展的文件都未找到而是找到了一个同名目录，则node会将其当做一个包来处理（首先node会在当前目录下查找<code>package.json</code>文件，取出其中<code>main</code>属性指定的文件名进行定位，若文件扩展名省略，则同样按前面的方式进一步判断。若<code>main</code>属性指定的文件名错误，或根本没有<code>package.json</code>文件，则node会将<code>index</code>当做默认文件名继续查找，若仍未找到三种格式之一的任何文件，则node会进入上一层<code>node_modules</code>中继续查找(若该模块只是一个包名，而非路径)，直至根目录仍未找到则会抛出错误）。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 使用require引入math.js模块，之后math.js模块中定义导出的方法或属性都可以通过math变量访问到（相当于将math.js中的module.exports赋给了math变量）</span>
<span class="token keyword">let</span> math <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./math'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
math<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="包与npm"><a href="#包与npm" class="header-anchor">#</a> 包与NPM</h2> <h3 id="包的基本构成"><a href="#包的基本构成" class="header-anchor">#</a> 包的基本构成</h3> <p>CommonJS的包规范的定义由包结构和包描述文件两个部分组成，前者用于组织包中的各种文件，后者则用于描述包的相关信息，以供外部读取分析。</p> <p>完全符合CommonJS规范的包目录包含如下文件：</p> <ul><li>package.json：包描述文件（位于包的根目录下）</li> <li>bin：用于存放可执行二进制文件的目录</li> <li>lib：用于存放JavaScript代码的目录</li> <li>doc：用于存放文档的目录</li> <li>test：用于存放单元测试用例的代码</li></ul> <p>包描述文件用于表达非代码相关的信息，而NPM的所有行为都与包描述文件的字段息息相关，NPM在实践中对CommonJS为package.json文件定义的字段做了一定的取舍，NPM实际用到的字段主要有以下这些：</p> <ul><li><strong>name：</strong> 包名，需要有小写字母和数字组成，可以包含<code>.</code>、<code>_</code>、<code>-</code>字符，但不允许有空格。包名必须唯一(全网唯一)，且最好不要有node、js这样的标识（因NPM本来就是JS和Node模块的专用包管理工具）</li> <li><strong>version：</strong> 包的版本号，一个语义化的版本号，通常为<code>major.minor.revision</code>格式</li> <li><strong>description：</strong> 包简介</li> <li><strong>keywords：</strong> 关键词数组，NPM中主要用来做分类搜索，便于用户快速查找到我们编写的包</li> <li><strong>repositories：</strong> 源代码托管的仓库位置列表</li> <li><strong>author：</strong> 包作者</li> <li><strong>bin：</strong> 有些包可以作为命令行工具使用，配置好该字段后，通过<code>npm install package_name -g</code>命令可以将脚本添加到执行路径中，之后可以在命令行中直接执行。<code>-g</code>参数表示全局安装，安装一次，所有地方都可使用(无需再安装，除非需要使用指定版本，采用局部安装使用)</li> <li><strong>main：</strong> 包的入口文件，在调用<code>require()</code>方法引入该包时，会优先检查该字段，将该字段指定的文件作为其余模块的入口。若不存在该字段，则会依次查找该包根目录下的index.js、index.node、index.json文件作为默认入口</li> <li><strong>scripts：</strong> 脚本说明对象，主要被包管理器用来安装、编译、测试、卸载包</li> <li><strong>engines：</strong> 支持的JavaScript引擎列表，如node、v8、ejs等(还可指定支持的版本)</li> <li><strong>dependencies：</strong> 当前包所需要的依赖包列表，该属性十分重要，NPM会通过该属性自动加载依赖的包</li> <li><strong>devDependencies：</strong> 开发依赖包列表。有些包(或模块)只在开发时需要依赖(像一些提高开发效率的工具)，与该包提供的功能无关，打包输出时并不需要，则通过该字段进行配置</li></ul> <h3 id="包的安装"><a href="#包的安装" class="header-anchor">#</a> 包的安装</h3> <p><strong>注意：</strong> 在执行<code>npm install package_name -g</code>命令进行全局安装时，其并不是将该模块安装为一个全局包的意思，其并不意味着可以从任何地方通过<code>require()</code>来引用它。实际上<code>-g</code>全局模式是将一个包<strong>安装为全局可用的可执行命令</strong>，它将包描述文件(package.json)中的<code>bin</code>字段指定的实际可执行脚本文件链接到与node可执行文件相同的路径下。
事实上，通过全局模式安装的所有模块包都被安装进了一个统一的目录下，这个目录可以通过如下方式推算出来：</p> <div class="language-js extra-class"><pre class="language-js"><code>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>execPath<span class="token punctuation">,</span> <span class="token string">'..'</span><span class="token punctuation">,</span> <span class="token string">'..'</span><span class="token punctuation">,</span> <span class="token string">'lib'</span><span class="token punctuation">,</span> <span class="token string">'node_modules'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>如果Node可执行文件的位置是/usr/local/bin/node，那么模块目录就是/usr/local/lib/node_modules。</p> <h4 id="从本地安装"><a href="#从本地安装" class="header-anchor">#</a> 从本地安装</h4> <p>对于一些没有发布到NPM上的包，或是因网络原因导致无法直接安装的包，可通过下载到本地进行本地安装，只需为NPM指明package.json文件所在的位置即可：</p> <ol><li>可以是一个包含package.json的存档文件(tar.gz/zip格式?)；</li> <li>也可以是一个Url地址；</li> <li>也可以是一个目录下有package.json文件的目录位置。</li></ol> <h4 id="从非官方源安装"><a href="#从非官方源安装" class="header-anchor">#</a> 从非官方源安装</h4> <ul><li>通过<code>--registry</code>指定安装源：<code>npm install package_name --registry=某安装源</code></li> <li>若所有包都从镜像源安装，则我们可以配置修改默认安装源，这样就无需在安装每个包时都指定一遍安装源，如我们将默认的官方源<code>https://www.npmjs.org</code>换成淘宝镜像源：<code>npm config set registry https://registry.npm.taobao.org</code>，查看当前默认安装源可以命令行<code>npm config get registry</code></li></ul> <h4 id="npm钩子命令-对包执行某操作时的钩子"><a href="#npm钩子命令-对包执行某操作时的钩子" class="header-anchor">#</a> npm钩子命令（对包执行某操作时的钩子）</h4> <p>package.json中scripts字段的提出就是让包在安装或卸载等过程中提供钩子机制，示例如下：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;preinstall&quot;</span><span class="token operator">:</span> <span class="token string">&quot;preinstall.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;install&quot;</span><span class="token operator">:</span> <span class="token string">&quot;install.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;uninstall&quot;</span><span class="token operator">:</span> <span class="token string">&quot;uninstall.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;test.js&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当在执行<code>npm install package_name</code>时将加载执行preinstall指向的脚本，然后是install指向的脚本；当执行<code>npm uninstall package_name</code>时，uninstall执行的脚本也许会做一些清理工作等；当在一个<strong>具体的包目录下执行</strong><code>npm test</code>时，将会运行test指向的脚本。一个优秀的包应当包含测试用例，并在package.json文件中配置好运行测试的命令，方便用户运行测试用例，以便检验包是否稳定可靠。</p> <h4 id="检索包列表"><a href="#检索包列表" class="header-anchor">#</a> 检索包列表</h4> <p>使用<code>npm ls</code>命令可以分析出当前路径下能够通过模块路径找到的所有npm包，并生成依赖树，类似下面这样：</p> <div class="language- extra-class"><pre class="language-text"><code>├─┬ registry-auth-token@4.2.1
│ └─┬ rc@1.2.8
│   ├── deep-extend@0.6.0
│   ├── ini@1.3.8
│   ├── minimist@1.2.5 deduped
│   └── strip-json-comments@2.0.1
</code></pre></div><h3 id="包的编写发布流程"><a href="#包的编写发布流程" class="header-anchor">#</a> 包的编写发布流程</h3> <p>编写的包需要发布到官方源或公司的私有源，已达到与其他人共享的目的。</p> <h4 id="初始化包描述文件-package-json"><a href="#初始化包描述文件-package-json" class="header-anchor">#</a> 初始化包描述文件(package.json)</h4> <p>在要创建包的目录下执行<code>npm init</code>命令，npm将通过提问式的交互让你逐个填入选项，生成预览的包描述文件，最后会在目录下得到一个package.json文件，暂不确定的选项可以跳过不填，所有内容也可以在生成json文件后再直接手动修改文件(注意应该用main字段指明包的入口文件)。</p> <h4 id="编写包的模块内容"><a href="#编写包的模块内容" class="header-anchor">#</a> 编写包的模块内容</h4> <p>编写相关的模块代码，最后要在入口文件中使用<code>exports</code>或<code>module.exports</code>导出相关的暴露给他人调用的API。</p> <h4 id="登录包仓库-npm-账号"><a href="#登录包仓库-npm-账号" class="header-anchor">#</a> 登录包仓库(npm)账号</h4> <p>不管是官方NPM仓库还是公司的私有NPM仓库，都必须要有对应的仓库账号才允许将包发布到仓库中。使用<code>npm adduser [--registry=url]</code>命令，也可以将<code>adduser</code>换成<code>login</code>(是前者的别名)，执行该命令后按照提示输入用户名等验证信息登录到对应的NPM仓库。可选参数<code>--registry</code>可指定登录的npm源，不指定这位设置中的默认源。另外对应有<code>npm logout [--registry=url]</code>命令退出登录。</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 登录npm仓库</span>
<span class="token function">npm</span> adduser <span class="token punctuation">[</span>--registry<span class="token operator">=</span>url<span class="token punctuation">]</span>
<span class="token comment"># 或</span>
<span class="token function">npm</span> login <span class="token punctuation">[</span>--registry<span class="token operator">=</span>url<span class="token punctuation">]</span>
<span class="token comment"># 登出npm仓库</span>
<span class="token function">npm</span> <span class="token builtin class-name">logout</span> <span class="token punctuation">[</span>--registry<span class="token operator">=</span>url<span class="token punctuation">]</span>
</code></pre></div><h4 id="上传-发布包"><a href="#上传-发布包" class="header-anchor">#</a> 上传/发布包</h4> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 上传/发布包</span>
<span class="token function">npm</span> publish <span class="token operator">&lt;</span>folder<span class="token operator">&gt;|</span><span class="token operator">&lt;</span>tarball<span class="token operator">&gt;</span> <span class="token punctuation">[</span>--tag <span class="token operator">&lt;</span>tag<span class="token operator">&gt;</span><span class="token punctuation">]</span>

<span class="token comment"># 移除已发布的包</span>
<span class="token function">npm</span> unpublish package_name<span class="token punctuation">[</span>@<span class="token operator">&lt;</span>tag<span class="token operator">&gt;</span><span class="token punctuation">]</span>
</code></pre></div><p>参数含义：</p> <ul><li>folder：一个包含package.json文件的文件夹位置，若就在当前文件夹下则可以直接用<code>.</code>表示：<code>npm publish .</code></li> <li>tarball：表示也可以是指向一个根目录包含package.json文件的tar格式压缩包的url地址或本地文件路径</li> <li>可选参数<code>--tag</code>，用于指定当前发布的包的标签(一般跟包的version版本号一直，以用于区分版本)，不指定时默认为<code>latest</code>(最新版)，在根据包名安装时就可以安装指定的版本<code>npm install &lt;package_name&gt;@&lt;tag&gt;</code>，否则就默认安装最新版。</li></ul> <p><strong>注意：</strong> 上传/发布包时，若不存在本地<code>.gitignore</code>或<code>.npmignore</code>文件，则包目录中的所有文件都会上传，否则将忽略这些文件中匹配的文件。但是，若这两个文件都存在，若<code>.gitignore</code>匹配的文件在<code>.npmignore</code>中并未匹配，则该部分文件还是会上传。即：<strong><code>.npmignore</code>文件存在则以其为准，若不存在则以<code>.gitignore</code>文件为准</strong>，若都不存在则所有文件都会被上传。</p> <h4 id="包权限管理"><a href="#包权限管理" class="header-anchor">#</a> 包权限管理</h4> <p>通常，一个包只有一个人拥有权限进行发布。如果需要多人进行发布，可以使用<code>npm owner</code>命令帮助我们管理包的所有者(只有该包的所有者才有该包的发布权限)：</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 下面的`owner`也可以使用其别名`author`替换，即：npm author ...</span>

<span class="token comment"># ls 列出对应包的全部所有者</span>
<span class="token function">npm</span> owner <span class="token function">ls</span> <span class="token operator">&lt;</span>package_name<span class="token operator">&gt;</span>

<span class="token comment"># add 添加某人到该包的所有者列表中</span>
<span class="token function">npm</span> owner <span class="token function">add</span> <span class="token operator">&lt;</span>username<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>package_name<span class="token operator">&gt;</span>

<span class="token comment"># rm 将某人从该包所有者列表中移除</span>
<span class="token function">npm</span> owner <span class="token function">rm</span> <span class="token operator">&lt;</span>username<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>package_name<span class="token operator">&gt;</span>
</code></pre></div><p>UMD叫通用模块定义规范，它可以通过运行时或者编译时让同一个代码模块在使用 CommonJs、CMD 甚至是 AMD 的项目中运行，其没有自己的专有规范，只是根据当前环境支持的规范进行判断定义。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">root<span class="token punctuation">,</span> factory</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 判断当前环境为什么规范，就按对应的规范进行定义</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> define <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">&amp;&amp;</span> define<span class="token punctuation">.</span>amd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//AMD</span>
    <span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'jquery'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> factory<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> exports <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//CommonJS</span>
    <span class="token keyword">var</span> $ <span class="token operator">=</span> <span class="token function">requie</span><span class="token punctuation">(</span><span class="token string">'jquery'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span>$<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    root<span class="token punctuation">.</span>testModule <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>jQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">$</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//todo</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="指定项目node版本依赖"><a href="#指定项目node版本依赖" class="header-anchor">#</a> 指定项目node版本依赖</h2> <p>见 <a href="/docs/" class="router-link-active">首页</a> 中相关内容说明。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/typescript/理解声明/三斜线指令和d.ts文件.html" class="prev">
        三斜线指令和 .d.ts文件
      </a></span> <span class="next"><a href="/docs/webpack/webpack4.x笔记.html">
        webpack4.x笔记
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/docs/assets/js/app.744a69eb.js" defer></script><script src="/docs/assets/js/2.23b2ce06.js" defer></script><script src="/docs/assets/js/44.142c8386.js" defer></script>
  </body>
</html>
