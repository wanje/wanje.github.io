<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>第11章 自定义着色器和后期处理 | Notebook</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="个人学习记录，资料收集备忘">
    
    <link rel="preload" href="/assets/css/0.styles.0621086d.css" as="style"><link rel="preload" href="/assets/js/app.fcdf30b9.js" as="script"><link rel="preload" href="/assets/js/2.8eecf2bf.js" as="script"><link rel="preload" href="/assets/js/9.65f1c4aa.js" as="script"><link rel="prefetch" href="/assets/js/10.2a6c16bc.js"><link rel="prefetch" href="/assets/js/11.68419d50.js"><link rel="prefetch" href="/assets/js/12.a68c305d.js"><link rel="prefetch" href="/assets/js/13.3cc74602.js"><link rel="prefetch" href="/assets/js/14.a25b30b4.js"><link rel="prefetch" href="/assets/js/15.925f2603.js"><link rel="prefetch" href="/assets/js/16.348b7114.js"><link rel="prefetch" href="/assets/js/17.9f943614.js"><link rel="prefetch" href="/assets/js/18.fb379ed6.js"><link rel="prefetch" href="/assets/js/19.255e3251.js"><link rel="prefetch" href="/assets/js/20.332f15f8.js"><link rel="prefetch" href="/assets/js/21.1f86b0c6.js"><link rel="prefetch" href="/assets/js/22.f90183d4.js"><link rel="prefetch" href="/assets/js/23.366600d7.js"><link rel="prefetch" href="/assets/js/24.814e76d6.js"><link rel="prefetch" href="/assets/js/25.18e09990.js"><link rel="prefetch" href="/assets/js/26.5e880f50.js"><link rel="prefetch" href="/assets/js/27.e3e96d9d.js"><link rel="prefetch" href="/assets/js/28.e7ad9699.js"><link rel="prefetch" href="/assets/js/29.85d29683.js"><link rel="prefetch" href="/assets/js/3.34c9b9f0.js"><link rel="prefetch" href="/assets/js/30.8bd0faad.js"><link rel="prefetch" href="/assets/js/31.5e798df8.js"><link rel="prefetch" href="/assets/js/32.25e54e91.js"><link rel="prefetch" href="/assets/js/33.073b75fe.js"><link rel="prefetch" href="/assets/js/34.04e2cc0e.js"><link rel="prefetch" href="/assets/js/35.08659d49.js"><link rel="prefetch" href="/assets/js/36.f19a6bcd.js"><link rel="prefetch" href="/assets/js/37.6bef776d.js"><link rel="prefetch" href="/assets/js/38.7f136def.js"><link rel="prefetch" href="/assets/js/39.efe3ea02.js"><link rel="prefetch" href="/assets/js/4.f5247ed6.js"><link rel="prefetch" href="/assets/js/40.204b2e79.js"><link rel="prefetch" href="/assets/js/41.6e319dc3.js"><link rel="prefetch" href="/assets/js/42.078cd8c6.js"><link rel="prefetch" href="/assets/js/43.86d222dd.js"><link rel="prefetch" href="/assets/js/44.3be8e4f5.js"><link rel="prefetch" href="/assets/js/45.648122ed.js"><link rel="prefetch" href="/assets/js/46.624347a8.js"><link rel="prefetch" href="/assets/js/47.8144871f.js"><link rel="prefetch" href="/assets/js/48.a9d91390.js"><link rel="prefetch" href="/assets/js/49.4c99775a.js"><link rel="prefetch" href="/assets/js/5.2b92acf9.js"><link rel="prefetch" href="/assets/js/50.ffd972b6.js"><link rel="prefetch" href="/assets/js/51.1b26a7ff.js"><link rel="prefetch" href="/assets/js/52.fd8b5b42.js"><link rel="prefetch" href="/assets/js/53.5a384665.js"><link rel="prefetch" href="/assets/js/54.a2df3ded.js"><link rel="prefetch" href="/assets/js/55.066984bb.js"><link rel="prefetch" href="/assets/js/56.276cf056.js"><link rel="prefetch" href="/assets/js/57.2df4d5b1.js"><link rel="prefetch" href="/assets/js/58.cb9bc504.js"><link rel="prefetch" href="/assets/js/59.eb623841.js"><link rel="prefetch" href="/assets/js/6.4a5deb6c.js"><link rel="prefetch" href="/assets/js/60.ca389fe4.js"><link rel="prefetch" href="/assets/js/61.72c249d5.js"><link rel="prefetch" href="/assets/js/62.282ecc40.js"><link rel="prefetch" href="/assets/js/63.f47a565b.js"><link rel="prefetch" href="/assets/js/64.7ff4ec20.js"><link rel="prefetch" href="/assets/js/65.abbe7832.js"><link rel="prefetch" href="/assets/js/66.1d1a2e4a.js"><link rel="prefetch" href="/assets/js/67.42971dbf.js"><link rel="prefetch" href="/assets/js/68.0f80686c.js"><link rel="prefetch" href="/assets/js/69.a769a649.js"><link rel="prefetch" href="/assets/js/7.4ab8c4f8.js"><link rel="prefetch" href="/assets/js/70.5e91d2b6.js"><link rel="prefetch" href="/assets/js/71.1e0b3f24.js"><link rel="prefetch" href="/assets/js/72.92c283d5.js"><link rel="prefetch" href="/assets/js/73.193f37bc.js"><link rel="prefetch" href="/assets/js/74.91203fcd.js"><link rel="prefetch" href="/assets/js/8.4ce9578d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.0621086d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="Notebook" class="logo"> <span class="site-name can-hide">Notebook</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="笔记分类" class="dropdown-title"><span class="title">笔记分类</span> <span class="arrow down"></span></button> <button type="button" aria-label="笔记分类" class="mobile-dropdown-title"><span class="title">笔记分类</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/js/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/html/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/css/" class="nav-link">
  CSS
</a></li></ul></div></div><div class="nav-item"><a href="https://wanje.github.io/demo_notes/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  更多
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="笔记分类" class="dropdown-title"><span class="title">笔记分类</span> <span class="arrow down"></span></button> <button type="button" aria-label="笔记分类" class="mobile-dropdown-title"><span class="title">笔记分类</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/js/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/html/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/css/" class="nav-link">
  CSS
</a></li></ul></div></div><div class="nav-item"><a href="https://wanje.github.io/demo_notes/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  更多
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>HTML</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/html/a标签的各种用途.html" class="sidebar-link">a标签的各种用途</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JavaScript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/js/JS零散集.html" class="sidebar-link">JS零散集</a></li><li><a href="/js/数组Array.html" class="sidebar-link">数组Array</a></li><li><a href="/js/字符串String.html" class="sidebar-link">字符串String</a></li><li><a href="/js/计算Math.html" class="sidebar-link">计算Math</a></li><li><a href="/js/事件Event.html" class="sidebar-link">事件Event</a></li><li><a href="/js/WebComponents.html" class="sidebar-link">Web Components</a></li><li><a href="/js/File文件API.html" class="sidebar-link">File文件API</a></li><li><a href="/js/鼠标拖放与拖拽dnd.html" class="sidebar-link">鼠标拖拽与拖放</a></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>ES6+</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/js/es6+/Class.html" class="sidebar-link">Class</a></li><li><a href="/js/es6+/Promise.html" class="sidebar-link">Promise</a></li><li><a href="/js/es6+/async-await.html" class="sidebar-link">async/await</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>CSS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/css/CSS零散集.html" class="sidebar-link">CSS零散集</a></li><li><a href="/css/scss语法.html" class="sidebar-link">SCSS基础语法</a></li><li><a href="/css/flex弹性布局.html" class="sidebar-link">flex弹性布局</a></li><li><a href="/css/CSS选择器世界.html" class="sidebar-link">CSS选择器世界</a></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>CSS世界</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/css/CSS世界/层叠规则.html" class="sidebar-link">层叠规则</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>CSS新世界</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>绘图&amp;动画</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/draw-animation/D3js.html" class="sidebar-link">D3.js</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Threejs开发指南</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/draw-animation/Threejs开发指南/第1章.html" class="sidebar-link">第1章 概览</a></li><li><a href="/draw-animation/Threejs开发指南/第2章.html" class="sidebar-link">第2章 构建Three.js应用的基本组件</a></li><li><a href="/draw-animation/Threejs开发指南/第3章.html" class="sidebar-link">第3章 学习使用Three.js中的光源</a></li><li><a href="/draw-animation/Threejs开发指南/第4章.html" class="sidebar-link">第4章 使用Three.js的材质</a></li><li><a href="/draw-animation/Threejs开发指南/第5章.html" class="sidebar-link">第5章 学习使用几何体</a></li><li><a href="/draw-animation/Threejs开发指南/第6章.html" class="sidebar-link">第6章 高级几何体和二元操作</a></li><li><a href="/draw-animation/Threejs开发指南/第7章.html" class="sidebar-link">第7章 粒子与精灵</a></li><li><a href="/draw-animation/Threejs开发指南/第8章.html" class="sidebar-link">第8章 创建/加载高级网格和几何体</a></li><li><a href="/draw-animation/Threejs开发指南/第9章.html" class="sidebar-link">第9章 创建动画和移动摄像机</a></li><li><a href="/draw-animation/Threejs开发指南/第10章.html" class="sidebar-link">第10章 加载和使用纹理</a></li><li><a href="/draw-animation/Threejs开发指南/第11章.html" class="active sidebar-link">第11章 自定义着色器和后期处理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/draw-animation/Threejs开发指南/第11章.html#_11-1-配置three-js以进行后期处理" class="sidebar-link">11.1 配置Three.js以进行后期处理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/draw-animation/Threejs开发指南/第11章.html#_1-创建three-effectcomposer对象" class="sidebar-link">1.创建THREE.EffectComposer对象</a></li><li class="sidebar-sub-header"><a href="/draw-animation/Threejs开发指南/第11章.html#_2-为后期处理配置three-effectcomposer" class="sidebar-link">2.为后期处理配置THREE.EffectComposer</a></li><li class="sidebar-sub-header"><a href="/draw-animation/Threejs开发指南/第11章.html#_3-更新渲染循环" class="sidebar-link">3.更新渲染循环</a></li></ul></li><li class="sidebar-sub-header"><a href="/draw-animation/Threejs开发指南/第11章.html#_11-2-后期处理通道" class="sidebar-link">11.2 后期处理通道</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/draw-animation/Threejs开发指南/第11章.html#_11-2-1-简单后期处理通道" class="sidebar-link">11.2.1 简单后期处理通道</a></li><li class="sidebar-sub-header"><a href="/draw-animation/Threejs开发指南/第11章.html#_11-2-2-使用掩码的高级效果组合器" class="sidebar-link">11.2.2 使用掩码的高级效果组合器</a></li></ul></li></ul></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Vue</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vue/vue工程配置.html" class="sidebar-link">Vue工程创建及配置</a></li><li><a href="/vue/vue基础语法.html" class="sidebar-link">Vue基础语法</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>React</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/react/react工程配置.html" class="sidebar-link">React工程创建及配置</a></li><li><a href="/react/react基础语法.html" class="sidebar-link">React基础语法</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>TypeScript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/typescript/类型/为什么需要类型.html" class="sidebar-link">为什么需要类型</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>类型</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>泛型</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>类型转换</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/typescript/模块/CommonJS兼容模块.html" class="sidebar-link">CommonJS兼容模块</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>命名空间</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>理解声明</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Node</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/node/Node模块机制.html" class="sidebar-link">Node模块机制与NPM包</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Webpack</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/webpack/webpack4.x笔记.html" class="sidebar-link">webpack4.x笔记</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Python</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/python/python基础语法.html" class="sidebar-link">Python基础语法</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>其他</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/others/参考内容.html" class="sidebar-link">参考内容</a></li><li><a href="/others/Markdown语法.html" class="sidebar-link">Markdown语法</a></li><li><a href="/others/Git使用.html" class="sidebar-link">Git使用</a></li><li><a href="/others/Gulp使用.html" class="sidebar-link">Gulp使用</a></li><li><a href="/others/Nginx配置.html" class="sidebar-link">Nginx基础配置与操作</a></li><li><a href="/others/环境&amp;软件安装.html" class="sidebar-link">环境&amp;软件安装</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="第11章-自定义着色器和后期处理"><a href="#第11章-自定义着色器和后期处理" class="header-anchor">#</a> 第11章 自定义着色器和后期处理</h1> <p>本章介绍的所有后期效果都是在已经渲染完成一帧场景画面之后添加的，所以称为“后期”处理。</p> <h2 id="_11-1-配置three-js以进行后期处理"><a href="#_11-1-配置three-js以进行后期处理" class="header-anchor">#</a> 11.1 配置Three.js以进行后期处理</h2> <p>为了能够使用Three.js进行后期处理，我们需要进行如下一些修改：</p> <ul><li>创建<code>THREE.EffectComposer</code>(效果组合器)对象，在该对象上我们可以添加后期处理通道；</li> <li>配置<code>THREE.EffectComposer</code>对象，使它可以渲染场景，并应用后期处理；</li> <li>在渲染循环中，使用<code>THREE.EffectComposer</code>来渲染场景、应用通道和输出结果。</li></ul> <h3 id="_1-创建three-effectcomposer对象"><a href="#_1-创建three-effectcomposer对象" class="header-anchor">#</a> 1.创建<code>THREE.EffectComposer</code>对象</h3> <p>首先需要引入相应的JS文件，这些文件在<code>examples/js/postprocessing</code>和<code>examples/js/shaders</code>目录下。
为了使得<code>THREE.EffectComposer</code>正常工作，至少需要包含如下的几个文件(Pass可理解为通道)：</p> <ul><li><code>postprocessing/EffectComposer.js</code>提供<code>THREE.EffectComposer</code>对象；</li> <li><code>postprocessing/ShaderPass.js</code>是<code>THREE.EffectComposer</code>内部使用到的文件；</li> <li><code>postprocessing/MaskPass.js</code>是<code>THREE.EffectComposer</code>内部使用到的文件；</li> <li><code>postprocessing/RenderPass.js</code>用于在<code>THREE.EffectComposer</code>对象上添加渲染通道，若没有通道，场景就不会被渲染；</li> <li><code>shaders/CopyShader.js</code>是<code>THREE.EffectComposer</code>内部使用到的文件。</li></ul> <p>以下两个文件可用于产生一种类似胶片的效果：</p> <ul><li><code>postprocessing/FilmPass.js</code></li> <li><code>shaders/FilmShader.js</code></li></ul> <p>创建<code>THREE.EffectComposer</code>对象：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> renderer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>WebGLRenderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> composer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>EffectComposer</span><span class="token punctuation">(</span>renderer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-为后期处理配置three-effectcomposer"><a href="#_2-为后期处理配置three-effectcomposer" class="header-anchor">#</a> 2.为后期处理配置<code>THREE.EffectComposer</code></h3> <p>每个通道都会按照其加入到<code>THREE.EffectComposer</code>的顺序执行。第一个加入的通道是<code>THREE.RenderPass</code>，该通道会渲染场景，但渲染结果不会输出到屏幕上：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> renderPass <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span><span class="token function">RenderPass</span><span class="token punctuation">(</span>scene<span class="token punctuation">,</span> camera<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 通过 addPass 方法向效果组合器中添加通道</span>
composer<span class="token punctuation">.</span><span class="token function">addPass</span><span class="token punctuation">(</span>renderPass<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 添加一个可以将结果输出到屏幕的通道(并不是所有通道都能实现该功能)</span>
<span class="token keyword">const</span> filmPass <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>FilmPass</span><span class="token punctuation">(</span><span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">0.325</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 这里添加一个胶片效果通道</span>
filmPass<span class="token punctuation">.</span>renderToScreen <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 使得结果可以输出到屏幕上</span>
composer<span class="token punctuation">.</span><span class="token function">addPass</span><span class="token punctuation">(</span>filmPass<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_3-更新渲染循环"><a href="#_3-更新渲染循环" class="header-anchor">#</a> 3.更新渲染循环</h3> <p>需要在循环中使用组合器来替换原来的<code>THREE.WebGLRenderer</code>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> clock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Clock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> delta <span class="token operator">=</span> clock<span class="token punctuation">.</span><span class="token function">getDelta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// renderer.render(scene, camera); 替换为如下组合器渲染</span>
  composer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>delta<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_11-2-后期处理通道"><a href="#_11-2-后期处理通道" class="header-anchor">#</a> 11.2 后期处理通道</h2> <p>Three.js库提供了许多后期处理通道，这些通道可以直接添加到<code>THREE.EffectComposer</code>组合器中使用。</p> <p>Three.js提供的可用的通道及功能概述：
<img src="/assets/img/THREE.X_Pass.ad5dc2fd.jpg" alt="Three.js提供的后期处理可用通道"></p> <p>Three.js还提供了另一种更好的景深效果，该效果可以利用<code>THREE.ShaderPass</code>调用着色器<code>THREE.BokehShader2</code>和<code>THREE.DOFMipMapShader</code>来实现，使用这些着色器需要一些较为复杂的设置。</p> <h3 id="_11-2-1-简单后期处理通道"><a href="#_11-2-1-简单后期处理通道" class="header-anchor">#</a> 11.2.1 简单后期处理通道</h3> <p><code>THREE.ShaderPass</code>和<code>THREE.TexturePass</code>两个通道可以将原始渲染结果的输出作为其他通道场景的输入，以此来重用原始渲染结果，当要分别显示多个后期处理通道的单个效果时很有用。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> renderPass <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span><span class="token function">RenderPass</span><span class="token punctuation">(</span>scene<span class="token punctuation">,</span> camera<span class="token punctuation">)</span><span class="token punctuation">;</span>
composer<span class="token punctuation">.</span><span class="token function">addPass</span><span class="token punctuation">(</span>renderPass<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// `THREE.ShaderPass`通道的作用是可以将前一个通道的输出结果复制到屏幕上，因有些通道不能直接将结果输出到屏幕上</span>
<span class="token comment">// 所以对于应用了不能直接将结果输出到屏幕上的通道，往往需要在最后将该通道添加到组合器中</span>
<span class="token keyword">const</span> shaderPass <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span><span class="token function">ShaderPass</span><span class="token punctuation">(</span><span class="token constant">THREE</span><span class="token punctuation">.</span>CopyShader<span class="token punctuation">)</span><span class="token punctuation">;</span>
shaderPass<span class="token punctuation">.</span>renderToScreen <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
composer<span class="token punctuation">.</span><span class="token function">addPass</span><span class="token punctuation">(</span>shaderPass<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> renderedScene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>TexturePass</span><span class="token punctuation">(</span>composer<span class="token punctuation">.</span>renderTarget2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 将上面`renderedScene`作为其他组合器的输入，就不需从零开始渲染场景</span>
</code></pre></div><h4 id="_1-使用three-filmpass创建类似电视的效果"><a href="#_1-使用three-filmpass创建类似电视的效果" class="header-anchor">#</a> 1.使用<code>THREE.FilmPass</code>创建类似电视的效果</h4> <p>前面已介绍如何创建<code>THREE.FilmPass</code>，下面介绍如何结合上面提到的<code>THREE.TexturePass</code>复用原始渲染结果来使用该效果。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> filmPass <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>FilmPass</span><span class="token punctuation">(</span><span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">0.325</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 参数说明见下图</span>
filmPass<span class="token punctuation">.</span>renderToScreen <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 使得结果可以输出到屏幕上</span>
<span class="token keyword">const</span> filmComposer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>EffectComposer</span><span class="token punctuation">(</span>renderer<span class="token punctuation">)</span><span class="token punctuation">;</span>
filmComposer<span class="token punctuation">.</span><span class="token function">addPass</span><span class="token punctuation">(</span>renderedScene<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 将`THREE.TexturePass`的输出作为组合器的第一个通道</span>
filmComposer<span class="token punctuation">.</span><span class="token function">addPass</span><span class="token punctuation">(</span>filmPass<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>THREE.FilmPass</code>的四个参数按顺序说明如下：
<img src="/assets/img/THREE.FilmPass.d27b311d.jpg" alt="THREE.FilmPass参数说明"></p> <p>这些参数除了在实例化时直接传入，还可以通过如下方式在实例上进行更改设置：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// uniforms 属性可直接与WebGL进行通信，将在自定义着色器中介绍</span>
filmPass<span class="token punctuation">.</span>uniforms<span class="token punctuation">.</span>grayscale<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'grayscale参数对应值'</span><span class="token punctuation">;</span>
filmPass<span class="token punctuation">.</span>uniforms<span class="token punctuation">.</span>nIntensity<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'noiseIntensity参数对应值'</span><span class="token punctuation">;</span>
filmPass<span class="token punctuation">.</span>uniforms<span class="token punctuation">.</span>sIntensity<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'scanlinesIntensity参数对应值'</span><span class="token punctuation">;</span>
filmPass<span class="token punctuation">.</span>uniforms<span class="token punctuation">.</span>sCount<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'scanlinesCount参数对应值'</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_2-使用three-bloompass在场景中添加泛光效果"><a href="#_2-使用three-bloompass在场景中添加泛光效果" class="header-anchor">#</a> 2.使用<code>THREE.BloomPass</code>在场景中添加泛光效果</h4> <p>当应用泛光效果时，场景中的明亮区域会变得更显著，且会渗入到较暗的区域，就像光源的边缘向外渐变扩散的效果。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> bloomPass <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>BloomPass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 参数说明见下图</span>
<span class="token keyword">const</span> bloomComposer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>EffectComposer</span><span class="token punctuation">(</span>renderer<span class="token punctuation">)</span><span class="token punctuation">;</span>
bloomComposer<span class="token punctuation">.</span><span class="token function">addPass</span><span class="token punctuation">(</span>renderedScene<span class="token punctuation">)</span><span class="token punctuation">;</span>
bloomComposer<span class="token punctuation">.</span><span class="token function">addPass</span><span class="token punctuation">(</span>bloomPass<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 将`THREE.ShaderPass`的输出作为组合器的最后一个通道，目的是将上一个通道的输出结果复制到屏幕上，</span>
<span class="token comment">// 因为`BloomPass`通道不能直接将渲染结果输出到屏幕上</span>
bloomComposer<span class="token punctuation">.</span><span class="token function">addPass</span><span class="token punctuation">(</span>shaderPass<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>THREE.BloomPass</code>的所有可选参数按顺序说明如下：
<img src="/assets/img/THREE.BloomPass.d3208135.jpg" alt="THREE.BloomPass参数说明"></p> <h4 id="_3-使用three-dotscreenpass将场景作为点集输出"><a href="#_3-使用three-dotscreenpass将场景作为点集输出" class="header-anchor">#</a> 3.使用<code>THREE.DotScreenPass</code>将场景作为点集输出</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> dotPass <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>DotScreenPass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 参数说明见下图，该通道也不能直接将渲染结果输出到屏幕上</span>
<span class="token keyword">const</span> dotComposer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>EffectComposer</span><span class="token punctuation">(</span>renderer<span class="token punctuation">)</span><span class="token punctuation">;</span>
dotComposer<span class="token punctuation">.</span><span class="token function">addPass</span><span class="token punctuation">(</span>renderedScene<span class="token punctuation">)</span><span class="token punctuation">;</span>
dotComposer<span class="token punctuation">.</span><span class="token function">addPass</span><span class="token punctuation">(</span>dotPass<span class="token punctuation">)</span><span class="token punctuation">;</span>
dotComposer<span class="token punctuation">.</span><span class="token function">addPass</span><span class="token punctuation">(</span>shaderPass<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>THREE.DotScreenPass</code>的所有可选参数按顺序说明如下：
<img src="/assets/img/THREE.DotScreenPass.dc881086.jpg" alt="THREE.DotScreenPass参数说明"></p> <h4 id="_4-在同一个屏幕上显示多个渲染器的输出结果"><a href="#_4-在同一个屏幕上显示多个渲染器的输出结果" class="header-anchor">#</a> 4.在同一个屏幕上显示多个渲染器的输出结果</h4> <p>也就是利用<code>renderer.setViewport()</code>方法将整个画布划分成多个区域进行不同显示(视口)，该方法的作用是设置视图显示区域(即将视图显示在画布上哪个区域)，依次接受4个参数<code>x</code>、<code>y</code>、<code>width</code>、<code>height</code>，即视口的起始坐标及宽高。该方法也可以用于多场景、多摄像机和多<code>WebGLRenderer</code>的情况。</p> <div class="language-js extra-class"><pre class="language-js"><code>renderer<span class="token punctuation">.</span>autoClear <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// 关闭自动清理画布，避免其将画布上所有区域内容都清除</span>
renderer<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 手动调用`clear()`方法，只在初次渲染时清除画布</span>
<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> delta <span class="token operator">=</span> clock<span class="token punctuation">.</span><span class="token function">getDelta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 显示`FilmPass`通道渲染结果</span>
  renderer<span class="token punctuation">.</span><span class="token function">setViewport</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> halfWidth<span class="token punctuation">,</span> halfHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
  filmComposer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>delta<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 显示`BloomPass`通道渲染结果</span>
  renderer<span class="token punctuation">.</span><span class="token function">setViewport</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> halfHeight<span class="token punctuation">,</span> halfWidth<span class="token punctuation">,</span> halfHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
  bloomComposer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>delta<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 显示`DotScreenPass`通道渲染结果</span>
  renderer<span class="token punctuation">.</span><span class="token function">setViewport</span><span class="token punctuation">(</span>halfWidth<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> halfWidth<span class="token punctuation">,</span> halfHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
  dotComposer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>delta<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 显示原始渲染结果</span>
  renderer<span class="token punctuation">.</span><span class="token function">setViewport</span><span class="token punctuation">(</span>halfWidth<span class="token punctuation">,</span> halfHeight<span class="token punctuation">,</span> halfWidth<span class="token punctuation">,</span> halfHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
  composer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>delta<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_5-更多简单后期处理通道"><a href="#_5-更多简单后期处理通道" class="header-anchor">#</a> 5.更多简单后期处理通道</h4> <p>通道的使用方法与前面也都一样：</p> <ul><li><code>THREE.OutlinePass</code>通道可以为场景中的模型勾勒轮廓；</li> <li><code>THREE.GlitchPass</code>通道可以模仿随机出现的电脉冲效果；</li> <li><code>THREE.UnrealBloom</code>通道同样实现泛光效果，但其效果看起来更接近<code>Unreal 3D</code>引擎中的泛光效果；</li> <li><code>THREE.HalftonePass</code>通道可以模仿传统印刷技术中的半色调效果；</li></ul> <h3 id="_11-2-2-使用掩码的高级效果组合器"><a href="#_11-2-2-使用掩码的高级效果组合器" class="header-anchor">#</a> 11.2.2 使用掩码的高级效果组合器</h3> <p>前面示例中都是在整个屏幕上应用后期处理通道，实际Three.js也可以在特定的区域使用通道。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/draw-animation/Threejs开发指南/第10章.html" class="prev">
        第10章 加载和使用纹理
      </a></span> <span class="next"><a href="/vue/vue工程配置.html">
        Vue工程创建及配置
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.fcdf30b9.js" defer></script><script src="/assets/js/2.8eecf2bf.js" defer></script><script src="/assets/js/9.65f1c4aa.js" defer></script>
  </body>
</html>
