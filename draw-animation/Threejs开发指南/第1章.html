<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>第1章 概览 | Notebook</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="个人学习记录，资料收集备忘">
    
    <link rel="preload" href="/assets/css/0.styles.0621086d.css" as="style"><link rel="preload" href="/assets/js/app.5bc2a58b.js" as="script"><link rel="preload" href="/assets/js/2.8eecf2bf.js" as="script"><link rel="preload" href="/assets/js/23.366600d7.js" as="script"><link rel="prefetch" href="/assets/js/10.05bce8b2.js"><link rel="prefetch" href="/assets/js/11.68419d50.js"><link rel="prefetch" href="/assets/js/12.a68c305d.js"><link rel="prefetch" href="/assets/js/13.05274784.js"><link rel="prefetch" href="/assets/js/14.6faaa385.js"><link rel="prefetch" href="/assets/js/15.b7a393bb.js"><link rel="prefetch" href="/assets/js/16.348b7114.js"><link rel="prefetch" href="/assets/js/17.80a37ac8.js"><link rel="prefetch" href="/assets/js/18.667fba00.js"><link rel="prefetch" href="/assets/js/19.75fecbf3.js"><link rel="prefetch" href="/assets/js/20.613b68bf.js"><link rel="prefetch" href="/assets/js/21.1f86b0c6.js"><link rel="prefetch" href="/assets/js/22.f90183d4.js"><link rel="prefetch" href="/assets/js/24.814e76d6.js"><link rel="prefetch" href="/assets/js/25.8b4d29fe.js"><link rel="prefetch" href="/assets/js/26.085b54ad.js"><link rel="prefetch" href="/assets/js/27.cd6cfa30.js"><link rel="prefetch" href="/assets/js/28.b08cb808.js"><link rel="prefetch" href="/assets/js/29.accf78e4.js"><link rel="prefetch" href="/assets/js/3.c47601e4.js"><link rel="prefetch" href="/assets/js/30.8bd0faad.js"><link rel="prefetch" href="/assets/js/31.cc37ffdb.js"><link rel="prefetch" href="/assets/js/32.25e54e91.js"><link rel="prefetch" href="/assets/js/33.64d9a07d.js"><link rel="prefetch" href="/assets/js/34.b0d78fcd.js"><link rel="prefetch" href="/assets/js/35.8bb866a9.js"><link rel="prefetch" href="/assets/js/36.f634d771.js"><link rel="prefetch" href="/assets/js/37.5c0f1fcd.js"><link rel="prefetch" href="/assets/js/38.6092d55e.js"><link rel="prefetch" href="/assets/js/39.e9c9d2bd.js"><link rel="prefetch" href="/assets/js/4.b606c983.js"><link rel="prefetch" href="/assets/js/40.f15d0d0f.js"><link rel="prefetch" href="/assets/js/41.6bd994cf.js"><link rel="prefetch" href="/assets/js/42.ba67c6a3.js"><link rel="prefetch" href="/assets/js/43.880d7d29.js"><link rel="prefetch" href="/assets/js/44.96c04999.js"><link rel="prefetch" href="/assets/js/45.19a88da5.js"><link rel="prefetch" href="/assets/js/46.4a475375.js"><link rel="prefetch" href="/assets/js/47.03e759cb.js"><link rel="prefetch" href="/assets/js/48.934efb2f.js"><link rel="prefetch" href="/assets/js/49.45a09d5d.js"><link rel="prefetch" href="/assets/js/5.af7be20e.js"><link rel="prefetch" href="/assets/js/50.13be0bdc.js"><link rel="prefetch" href="/assets/js/51.0ebedf34.js"><link rel="prefetch" href="/assets/js/52.79f6e3c2.js"><link rel="prefetch" href="/assets/js/53.44767a38.js"><link rel="prefetch" href="/assets/js/54.ceb0f83a.js"><link rel="prefetch" href="/assets/js/55.261c0da6.js"><link rel="prefetch" href="/assets/js/56.0fb04d4f.js"><link rel="prefetch" href="/assets/js/57.60cf9b45.js"><link rel="prefetch" href="/assets/js/58.2ae8b379.js"><link rel="prefetch" href="/assets/js/59.31f0800d.js"><link rel="prefetch" href="/assets/js/6.db0c34fd.js"><link rel="prefetch" href="/assets/js/60.f6dddae5.js"><link rel="prefetch" href="/assets/js/61.41199821.js"><link rel="prefetch" href="/assets/js/62.fe70b3ce.js"><link rel="prefetch" href="/assets/js/63.34bf20b8.js"><link rel="prefetch" href="/assets/js/64.5dc85041.js"><link rel="prefetch" href="/assets/js/65.a06e5a7e.js"><link rel="prefetch" href="/assets/js/66.a18b0386.js"><link rel="prefetch" href="/assets/js/67.0c25f7a9.js"><link rel="prefetch" href="/assets/js/68.0cf004ed.js"><link rel="prefetch" href="/assets/js/69.064d4605.js"><link rel="prefetch" href="/assets/js/7.4ab8c4f8.js"><link rel="prefetch" href="/assets/js/70.70589af6.js"><link rel="prefetch" href="/assets/js/71.10cf6e4c.js"><link rel="prefetch" href="/assets/js/72.f0c85099.js"><link rel="prefetch" href="/assets/js/8.5d1fdd4d.js"><link rel="prefetch" href="/assets/js/9.a170ad61.js">
    <link rel="stylesheet" href="/assets/css/0.styles.0621086d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="Notebook" class="logo"> <span class="site-name can-hide">Notebook</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="笔记分类" class="dropdown-title"><span class="title">笔记分类</span> <span class="arrow down"></span></button> <button type="button" aria-label="笔记分类" class="mobile-dropdown-title"><span class="title">笔记分类</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/js/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/html/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/css/" class="nav-link">
  CSS
</a></li></ul></div></div><div class="nav-item"><a href="https://wanje.github.io/demo_notes/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  更多
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="笔记分类" class="dropdown-title"><span class="title">笔记分类</span> <span class="arrow down"></span></button> <button type="button" aria-label="笔记分类" class="mobile-dropdown-title"><span class="title">笔记分类</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/js/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/html/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/css/" class="nav-link">
  CSS
</a></li></ul></div></div><div class="nav-item"><a href="https://wanje.github.io/demo_notes/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  更多
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>HTML</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/html/a标签的各种用途.html" class="sidebar-link">a标签的各种用途</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JavaScript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/js/JS零散集.html" class="sidebar-link">JS零散集</a></li><li><a href="/js/数组Array.html" class="sidebar-link">数组Array</a></li><li><a href="/js/字符串String.html" class="sidebar-link">字符串String</a></li><li><a href="/js/计算Math.html" class="sidebar-link">计算Math</a></li><li><a href="/js/事件Event.html" class="sidebar-link">事件Event</a></li><li><a href="/js/WebComponents.html" class="sidebar-link">Web Components</a></li><li><a href="/js/File文件API.html" class="sidebar-link">File文件API</a></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>ES6+</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/js/es6+/Class.html" class="sidebar-link">Class</a></li><li><a href="/js/es6+/Promise.html" class="sidebar-link">Promise</a></li><li><a href="/js/es6+/async-await.html" class="sidebar-link">async/await</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>CSS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/css/CSS零散集.html" class="sidebar-link">CSS零散集</a></li><li><a href="/css/scss语法.html" class="sidebar-link">SCSS基础语法</a></li><li><a href="/css/flex弹性布局.html" class="sidebar-link">flex弹性布局</a></li><li><a href="/css/CSS选择器世界.html" class="sidebar-link">CSS选择器世界</a></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>CSS世界</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/css/CSS世界/层叠规则.html" class="sidebar-link">层叠规则</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>CSS新世界</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>绘图&amp;动画</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/draw-animation/D3js.html" class="sidebar-link">D3.js</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Threejs开发指南</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/draw-animation/Threejs开发指南/第1章.html" class="active sidebar-link">第1章 概览</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/draw-animation/Threejs开发指南/第1章.html#初始化" class="sidebar-link">初始化</a></li><li class="sidebar-sub-header"><a href="/draw-animation/Threejs开发指南/第1章.html#添加控制器" class="sidebar-link">添加控制器</a></li><li class="sidebar-sub-header"><a href="/draw-animation/Threejs开发指南/第1章.html#将物体放在视图中间" class="sidebar-link">将物体放在视图中间</a></li><li class="sidebar-sub-header"><a href="/draw-animation/Threejs开发指南/第1章.html#鼠标事件处理" class="sidebar-link">鼠标事件处理</a></li><li class="sidebar-sub-header"><a href="/draw-animation/Threejs开发指南/第1章.html#二维坐标转换为三维坐标" class="sidebar-link">二维坐标转换为三维坐标</a></li><li class="sidebar-sub-header"><a href="/draw-animation/Threejs开发指南/第1章.html#三维坐标转换为二维坐标" class="sidebar-link">三维坐标转换为二维坐标</a></li><li class="sidebar-sub-header"><a href="/draw-animation/Threejs开发指南/第1章.html#更改物体旋转中心" class="sidebar-link">更改物体旋转中心</a></li><li class="sidebar-sub-header"><a href="/draw-animation/Threejs开发指南/第1章.html#镜头聚焦到某物体上" class="sidebar-link">镜头聚焦到某物体上</a></li><li class="sidebar-sub-header"><a href="/draw-animation/Threejs开发指南/第1章.html#自定义的一些three-js对象上的实用扩展方法" class="sidebar-link">自定义的一些Three.js对象上的实用扩展方法</a></li><li class="sidebar-sub-header"><a href="/draw-animation/Threejs开发指南/第1章.html#工具" class="sidebar-link">工具</a></li><li class="sidebar-sub-header"><a href="/draw-animation/Threejs开发指南/第1章.html#其他" class="sidebar-link">其他</a></li></ul></li><li><a href="/draw-animation/Threejs开发指南/第2章.html" class="sidebar-link">第2章 构建Three.js应用的基本组件</a></li><li><a href="/draw-animation/Threejs开发指南/第3章.html" class="sidebar-link">第3章 学习使用Three.js中的光源</a></li><li><a href="/draw-animation/Threejs开发指南/第4章.html" class="sidebar-link">第4章 使用Three.js的材质</a></li><li><a href="/draw-animation/Threejs开发指南/第5章.html" class="sidebar-link">第5章 学习使用几何体</a></li><li><a href="/draw-animation/Threejs开发指南/第6章.html" class="sidebar-link">第6章 高级几何体和二元操作</a></li><li><a href="/draw-animation/Threejs开发指南/第7章.html" class="sidebar-link">第7章 粒子与精灵</a></li><li><a href="/draw-animation/Threejs开发指南/第8章.html" class="sidebar-link">第8章 创建/加载高级网格和几何体</a></li><li><a href="/draw-animation/Threejs开发指南/第9章.html" class="sidebar-link">第9章 创建动画和移动摄像机</a></li><li><a href="/draw-animation/Threejs开发指南/第10章.html" class="sidebar-link">第10章 加载和使用纹理</a></li><li><a href="/draw-animation/Threejs开发指南/第11章.html" class="sidebar-link">第11章 自定义着色器和后期处理</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Vue</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vue/vue工程配置.html" class="sidebar-link">Vue工程创建及配置</a></li><li><a href="/vue/vue基础语法.html" class="sidebar-link">Vue基础语法</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>React</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/react/react工程配置.html" class="sidebar-link">React工程创建及配置</a></li><li><a href="/react/react基础语法.html" class="sidebar-link">React基础语法</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>TypeScript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/typescript/类型/为什么需要类型.html" class="sidebar-link">为什么需要类型</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>类型</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>泛型</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>类型转换</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/typescript/模块/CommonJS兼容模块.html" class="sidebar-link">CommonJS兼容模块</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>命名空间</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>理解声明</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Node</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/node/Node模块机制.html" class="sidebar-link">Node模块机制与NPM包</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Webpack</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/webpack/webpack4.x笔记.html" class="sidebar-link">webpack4.x笔记</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Python</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/python/python基础语法.html" class="sidebar-link">Python基础语法</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>其他</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/others/Markdown语法.html" class="sidebar-link">Markdown语法</a></li><li><a href="/others/Git使用.html" class="sidebar-link">Git使用</a></li><li><a href="/others/Gulp使用.html" class="sidebar-link">Gulp使用</a></li><li><a href="/others/环境&amp;软件安装.html" class="sidebar-link">环境&amp;软件安装</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="第1章-概览"><a href="#第1章-概览" class="header-anchor">#</a> 第1章 概览</h1> <p>概览Three.js中的一些功能实现点（本文所有介绍都是基于 <em><strong>Three.js 95</strong></em> 版本）
<a href="https://threejs.org/docs/index.html#manual/zh/introduction/Creating-a-scene" target="_blank" rel="noopener noreferrer">Three.js官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="初始化"><a href="#初始化" class="header-anchor">#</a> 初始化</h2> <p>使用Three.js创建一个三维场景。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 创建场景（世界/画布的角色），that will hold all our elements such as objects, cameras and lights.</span>
<span class="token keyword">var</span> scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// scene.background = new THREE.Color(0x000000); // 设置场景背景色</span>

<span class="token comment">// 创建相机（眼睛的角色），which defines where we're looking at.</span>
<span class="token comment">// PerspectiveCamera为透视投影相机(还有正交投影相机)，四个参数分别代表：视角、相机宽高比、视野近平面距离、远平面距离</span>
<span class="token keyword">var</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PerspectiveCamera</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">,</span> window<span class="token punctuation">.</span>innerWidth <span class="token operator">/</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置相机位置，默认在原点可能看不到物体</span>
camera<span class="token punctuation">.</span>up<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 相机的上方朝向(观察者头顶朝向，即向量的指向，因为相机可以横着放，也可竖着放)</span>
<span class="token comment">// 设置相机朝向，实际其是使用相机当前位置和看向的位置形成一个向量表明朝向，并不是将视觉点始终放在了看向的位置(只有在相机位置改变的同时也一直将lookAt指向目标位置才会使得视觉点一直固定在目标位置上)</span>
camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>scene<span class="token punctuation">.</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这里看向场景中心，之后改变相机位置就只是平移，朝向不会改变(也就是方向不变)，只有再次执行该方法才会更新朝向</span>

<span class="token comment">// 创建渲染器（画笔的角色）</span>
<span class="token keyword">var</span> renderer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>WebGLRenderer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  antialias<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 开启抗锯齿</span>
  alpha<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 使画布背景透明</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
renderer<span class="token punctuation">.</span><span class="token function">setPixelRatio</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>devicePixelRatio<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将render的像素比设置为设备的像素比devicePixelRatio，避免在高清屏下模糊(抗锯齿)</span>
<span class="token comment">// renderer.setClearColor(new THREE.Color(0x000000)); // 设置渲染器颜色，还可指定第二个参数`透明度`（实际就是每次清除画布后的颜色，也可以直接用场景背景色），有背景图时不应设置，开启了画布背景透明也不应设置</span>
renderer<span class="token punctuation">.</span><span class="token function">setSize</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">,</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置场景渲染范围大小，也就是画布尺寸</span>
renderer<span class="token punctuation">.</span>shadowMap<span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 开启场景内阴影投射</span>

<span class="token comment">// 时钟，一些更新方法中可能会用到</span>
<span class="token keyword">const</span> clock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Clock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// const delta = clock.getDelta();</span>

<span class="token comment">// 创建控制器</span>
controls <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>OrbitControls</span><span class="token punctuation">(</span>camera<span class="token punctuation">,</span> renderer<span class="token punctuation">.</span>domElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
controls<span class="token punctuation">.</span>minZoom <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
controls<span class="token punctuation">.</span>maxPolarAngle <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 最大旋转90度，避免将地板旋转向上</span>
controls<span class="token punctuation">.</span>maxDistance <span class="token operator">=</span> camera<span class="token punctuation">.</span>far <span class="token operator">*</span> <span class="token number">0.9</span><span class="token punctuation">;</span> <span class="token comment">// 相机向外移动的最大距离，避免太远物体就缩小到看不到(或者超过相机far也看不到)</span>
controls<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 添加光源(光源有很多种)</span>
<span class="token keyword">var</span> ambienLight <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>AmbientLight</span><span class="token punctuation">(</span><span class="token number">0x353535</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 基本光源，环境光（不可用于创建阴影）</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>ambienLight<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> spotLight <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>SpotLight</span><span class="token punctuation">(</span><span class="token number">0xffffff</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 聚光光源（可用于创建阴影）</span>
spotLight<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置点光源位置</span>
spotLight<span class="token punctuation">.</span>castShadow <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 开启阴影投射</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>spotLight<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建地面</span>
<span class="token keyword">var</span> planeGeometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PlaneGeometry</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 定义一个指定宽高的平面作为地面，“Geometry”意为几何图形</span>
<span class="token keyword">var</span> planeMaterial <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshLambertMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span> color<span class="token operator">:</span> <span class="token number">0xffffff</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 定义材质</span>
<span class="token keyword">var</span> plane <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>planeGeometry<span class="token punctuation">,</span> planeMaterial<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 生成网格</span>
plane<span class="token punctuation">.</span>receiveShadow <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 接受阴影投射（即物体产生的阴影可以投影到该地面）</span>
plane<span class="token punctuation">.</span>rotation<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">0.5</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">;</span> <span class="token comment">// 旋转地面负90度，因为默认的二维平面是在XY面上，此时看着是竖着的</span>
plane<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置地面位置</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>plane<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将地面添加进场景渲染</span>

<span class="token comment">// 创建一个立方体</span>
<span class="token keyword">var</span> cubeGeometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>BoxGeometry</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个指定长宽高的立方体</span>
<span class="token keyword">var</span> cubeMaterial <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshLambertMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span> color<span class="token operator">:</span> <span class="token number">0xff0000</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> cube <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>cubeGeometry<span class="token punctuation">,</span> cubeMaterial<span class="token punctuation">)</span><span class="token punctuation">;</span>
cube<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cube<span class="token punctuation">.</span>castShadow <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 设置该物体可投射阴影</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>cube<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">// 将渲染器输出到页面（即将canvas元素放置到DOM中）</span>
<span class="token comment">// 也可以直接在页面中指定一个canvas元素，在前面实例化渲染器时就指定渲染器输出到该canvas元素，这里就不需要再手动添加</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;webgl-output&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>renderer<span class="token punctuation">.</span>domElement<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// renderer.domElement返回渲染器DOM</span>
<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 渲染物体</span>
<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// render using requestAnimationFrame</span>
  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span><span class="token punctuation">;</span>
  renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>scene<span class="token punctuation">,</span> camera<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 渲染场景内容</span>
  controls<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 自适应窗口调整，其中的相关尺寸要根据布局使用画布的尺寸</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> onResize<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">onResize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  camera<span class="token punctuation">.</span>aspect <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth <span class="token operator">/</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span> <span class="token comment">// 重新设置相机的宽高比</span>
  camera<span class="token punctuation">.</span><span class="token function">updateProjectionMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 更新相机投影变换矩阵</span>
  <span class="token comment">// 若初始化时不设置renderer的像素比，则也可以将下面的尺寸都乘以`window.devicePixelRatio`，但第三个参数需要传入false</span>
  renderer<span class="token punctuation">.</span><span class="token function">setSize</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">,</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 重新设置渲染器尺寸（画布尺寸）</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="添加控制器"><a href="#添加控制器" class="header-anchor">#</a> 添加控制器</h2> <p>控制器可以使得我们方便对整个场景进行缩放、旋转和移动操作，以查看空间各位置内容，实际就是对相机位置的控制。不同控制器的视角可能不同，所以看到的场景感受也会有所不同。</p> <p>下面以轨道控制器(<code>OrbitControls</code>)为例展示如何添加控制器：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 使用前需要先引入对应控制器组件JS文件</span>

<span class="token comment">// 创建控制器，实例对象上还提供了很多设置属性和一些方法调用（详细可查看文档）</span>
<span class="token comment">// 注意：`camera`的位置不能为默认的(0,0,0)原点，否则视角控制除了移动外其他旋转和缩放似乎不生效？</span>
<span class="token keyword">const</span> controls <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>OrbitControls</span><span class="token punctuation">(</span>camera<span class="token punctuation">,</span> renderer<span class="token punctuation">.</span>domElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// controls.enableDamping = true; // 设置该属性可开启控制器的惯性缓冲</span>
<span class="token comment">// 若对相机的位置进行了任何手动改变，都必须手动调用一次控制器的`update()`方法对控制器进行更新</span>
<span class="token comment">// controls.update();   // 比如实例化了相机后重置了其位置等久需要调用一次</span>

<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span><span class="token punctuation">;</span>
  controls<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 渲染函数中增加此方法调用，使得鼠标操作后自动更新控制器</span>
  renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>scene<span class="token punctuation">,</span> camera<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="将物体放在视图中间"><a href="#将物体放在视图中间" class="header-anchor">#</a> 将物体放在视图中间</h2> <p>对于从外部加载的模型，很多时候添加进场景后没看见模型显示在什么位置或是位置不对内容不完整(但打印模型位置显示又是在原点)，这主要是由于模型师建模时就不是参照场景中心建的，所以加载进场景后我们需要调整模型位置或是相机位置，使得模型图出现在视线中间(画布中间)，且视线中应该包含完整模型视图。有两种调整方式达到目的：</p> <p>方式一：将模型进行位置偏移并调整相机位置</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// `object`为场景对象，</span>
<span class="token comment">// `dRate`为相机与对象中心位置的距离应该是其包围盒半径的多少倍，可决定看到物体的大小</span>
<span class="token comment">// `direction`为相机位置相对其查看的场景对象的方向(向量)</span>
<span class="token keyword">function</span> <span class="token function">setModelPosition</span><span class="token punctuation">(</span>object<span class="token punctuation">,</span> dRate <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> direction <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  object<span class="token punctuation">.</span><span class="token function">updateMatrixWorld</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> box <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Box3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFromObject</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个来源于模型对象的包围盒，也可使用`expandByObject`方法效果类似</span>
  <span class="token keyword">const</span> boxSize <span class="token operator">=</span> box<span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 获取盒子的宽度、高度、深度，其由一个三维向量表示</span>
  <span class="token keyword">const</span> center <span class="token operator">=</span> box<span class="token punctuation">.</span><span class="token function">getCenter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取盒子的中心点</span>
  <span class="token keyword">const</span> radius <span class="token operator">=</span> boxSize<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>  <span class="token comment">// 包围盒半径</span>
  <span class="token comment">// 以下坐标计算方式不管`object.position`初始位置在哪，最后都偏移到物体中心位置</span>
  <span class="token comment">// 其原理可以理解为外部模型对象中已有的初始位置实际是以其自身参考系为准的，而不是我们页面中场景的世界坐标系为参考，</span>
  <span class="token comment">// 所以表现出虽然模型对象位置数据在原点却又不是与场景原点在同一位置，出现位置偏离的情况，</span>
  <span class="token comment">// 下面的三种方式就是让模型对象反向偏移其中心点的距离使其位置与当前场景原点重合</span>
  <span class="token comment">// 偏移方式一</span>
  <span class="token comment">// object.position.x -= center.x;</span>
  <span class="token comment">// object.position.y -= center.y;</span>
  <span class="token comment">// object.position.z -= center.z;</span>
  <span class="token comment">// 偏移方式二</span>
  <span class="token comment">// object.translateX(-center.x);</span>
  <span class="token comment">// object.translateY(-center.y);</span>
  <span class="token comment">// object.translateZ(-center.z);</span>
  <span class="token comment">// 偏移方式三</span>
  object<span class="token punctuation">.</span><span class="token function">translateOnAxis</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>center<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiplyScalar</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> center<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 设置相机位置，也有多种方式达到目的</span>
  <span class="token comment">// 方式一(最优)，根据想要的相机目的位置相对场景位置或其中心位置的方向和距离来设置其位置</span>
  camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">addVectors</span><span class="token punctuation">(</span>center <span class="token operator">||</span> object<span class="token punctuation">.</span>position<span class="token punctuation">,</span> direction<span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiplyScalar</span><span class="token punctuation">(</span>radius <span class="token operator">*</span> dRate<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 方式二，根据包围盒最大宽高设置相机的Z轴位置，和调增其他轴位置</span>
  <span class="token comment">// camera.position.z = Math.max(boxSize.x, boxSize.y) * rate; // `rate`可根据情况设置，以调整远近和在物体正面还是背面</span>
  camera<span class="token punctuation">.</span>far <span class="token operator">=</span> radius <span class="token operator">*</span> <span class="token number">15</span><span class="token punctuation">;</span> <span class="token comment">// 适当调整相机可见的最远距离，避免初始设置与模型不匹配</span>
  camera<span class="token punctuation">.</span><span class="token function">updateProjectionMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>方式二：调整相机参数及位置 <a href="https://threejsfundamentals.org/threejs/lessons/zh_cn/threejs-load-obj.html" target="_blank" rel="noopener noreferrer">原理参考<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">setModelPosition</span><span class="token punctuation">(</span><span class="token parameter">object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> box <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Box3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFromObject</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> boxSize <span class="token operator">=</span> box<span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这里计算的是盒子的直线长度(可理解为盒子最大直径)，就是由盒子长宽高得到的对角线长度</span>
  <span class="token keyword">const</span> boxCenter <span class="token operator">=</span> box<span class="token punctuation">.</span><span class="token function">getCenter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 计算相机到模型的视距</span>
  <span class="token keyword">const</span> distance <span class="token operator">=</span> <span class="token punctuation">(</span>boxSize <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token operator">/</span> Math<span class="token punctuation">.</span><span class="token function">tan</span><span class="token punctuation">(</span><span class="token constant">THREE</span><span class="token punctuation">.</span>MathUtils<span class="token punctuation">.</span><span class="token function">degToRad</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>fov <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 计算相机到盒子中心的单位方向向量</span>
  <span class="token keyword">const</span> direction <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subVectors</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>position<span class="token punctuation">,</span> boxCenter<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 设置相机位置</span>
  camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>direction<span class="token punctuation">.</span><span class="token function">multiplyScalar</span><span class="token punctuation">(</span>distance<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>boxCenter<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 可自行调整相机的远近视距</span>
  <span class="token comment">// camera.near = boxSize / 100; // 可不调整近视距</span>
  camera<span class="token punctuation">.</span>far <span class="token operator">=</span> boxSize <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">;</span>

  camera<span class="token punctuation">.</span><span class="token function">updateProjectionMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>boxCenter<span class="token punctuation">.</span>x<span class="token punctuation">,</span> boxCenter<span class="token punctuation">.</span>y<span class="token punctuation">,</span> boxCenter<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 相机看向模型中心</span>

  controls<span class="token punctuation">.</span>target <span class="token operator">=</span> boxCenter<span class="token punctuation">;</span>  <span class="token comment">// 将控制器的参考目标设为盒子中心，否则默认是场景中心</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="鼠标事件处理"><a href="#鼠标事件处理" class="header-anchor">#</a> 鼠标事件处理</h2> <p>要绑定处理鼠标事件(click点击、mousemove鼠标hover等)，实际就是确定我们在画布上的点击位置二维平面坐标映射到三维空间中时其投影是否穿过目标对象，可以通过光线投射<code>THREE.Raycaster</code>进行鼠标拾取(在三维空间中计算出鼠标经过了哪些物体)，其原理就是：相机与鼠标所在的画布(屏幕)上的坐标(二维坐标转换为场景中的三维坐标)之间的连线与哪些物体相交，相交的物体可能有多个(因为二维视觉上有前后遮挡重叠)，所以返回的点中物体是一个数组列表，顺序是离相机越近的越在前面，所以我们只需要判断数组第一个元素是不是我们想要的物体(避免是点击到其他物体穿透到我们目标物体上的)。<strong>还有一种检测点击到物体的方法，就是下面一节中提到的“二维坐标转换为三维坐标”的方式，原理都一样，只是写法有有部分不同，具体代码可查看【第九章9.1.2选择对象】一节</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 对画布(或其包裹容器)添加鼠标事件（因画布可能不是全屏的，所以未添加在window上）</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> raycaster <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Raycaster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 创建光线投射</span>
  <span class="token keyword">const</span> mouse <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 创建二维坐标点，用于保存鼠标位置点</span>

  <span class="token comment">// 将鼠标位置归一化为画布上二维坐标，x(向右)和y(向上)方向的取值范围是(-1,1)，也就是将画布中心看作原点(0,0)</span>
  <span class="token comment">// offsetX属性表示相对当前元素左边缘(包含padding，不包括边框)的距离，该属性存在兼容问题(Firefox下表现似乎就不一样)，可能需要自行计算坐标</span>
  <span class="token comment">// 鼠标事件在画布上的二维坐标也可这样计算得到：offsetX = event.clientX - renderer.domElement.offsetLeft</span>
  <span class="token comment">// 当只有一屏时可以使用`event.clientX`(相对浏览器内容窗口)，当页面存在滚动时需要使用`event.pageX`(相对页面整个文档)了，</span>
  <span class="token comment">// 使用`event.clientX`时当然也可以使用`dom.getBoundingClientRect()`方法获取画布的元素的位置信息(其也是相对内容窗口的)，只要参考系一样得到的相对坐标就一样</span>
  mouse<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>offsetX <span class="token operator">/</span> renderer<span class="token punctuation">.</span>domElement<span class="token punctuation">.</span>clientWidth<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
  mouse<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token operator">-</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>offsetY <span class="token operator">/</span> renderer<span class="token punctuation">.</span>domElement<span class="token punctuation">.</span>clientHeight<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
  raycaster<span class="token punctuation">.</span><span class="token function">setFromCamera</span><span class="token punctuation">(</span>mouse<span class="token punctuation">,</span> camera<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 根据鼠标点与相机位置更新光线射线</span>

  <span class="token comment">// 确定返回点击到的物体集合，可以检测场景内所有物体，也可以自己给一个待检测的物体数组(可减少检测，只关注需要交互的物体)</span>
  <span class="token keyword">const</span> intersectObjects <span class="token operator">=</span> raycaster<span class="token punctuation">.</span><span class="token function">intersectObjects</span><span class="token punctuation">(</span>scene<span class="token punctuation">.</span>children<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 第一个参数为要检测的对象集合，可选第二个布尔参数表示是否检测物体的后代对象(默认false)</span>

  <span class="token comment">// 判断点击到的物体是否是我们的目标物体</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>intersectObjects<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 若数组长度为0说明没有点击到目标检测物体中的任何一个物体</span>
    <span class="token comment">// 只判断第一个点中物体是否是我们的目标物体，因为后面的物体都是穿透前面的物体才点中的，不能算作真的点中了</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>intersectObjects<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>object<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">'targetName'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 这里通过比较物体的名字name来判断是否是我们的目标物体，也可以用其他属性，只要是能代表目标物体唯一性的就行</span>
      <span class="token comment">// 这里找到目标物体就可以进行下一步操作了</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'点击到了目标物体'</span><span class="token punctuation">,</span> intersectObjects<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>object<span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">intersectObjects数组中的每个网格对象都包含如下一些信息，其中
        ‘distance’表示摄像机到被点击对象的具体，
        ‘face’和‘faceIndex’表示该网格中被选中的面及该面在所有面中的索引位置，
        ‘point’表示网格上那个点被点击了，
        ‘uv’表示点击位置所对应的2D纹理的uv值，
        ‘object’则为该点中网格的mesh对象
      </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 这里还需注意，当对当前目标或其关联内容进行操作时，可能还要将其他目标或其关联内容进行还原处理</span>
      <span class="token comment">// 比如当前目标高亮时，要取消其他目标的高亮</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="二维坐标转换为三维坐标"><a href="#二维坐标转换为三维坐标" class="header-anchor">#</a> 二维坐标转换为三维坐标</h2> <p>将屏幕二维坐标转换为空间三维坐标，与前面处理鼠标事件中的坐标转换类似，只是这里只是坐标转换，不用发射光线检测与哪些物体相交（该方式用于处理鼠标选中对象的具体代码可查看<strong>第九章9.1.2选择对象</strong>）：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">to3DPosition</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 归一化屏幕坐标</span>
  <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>offsetX <span class="token operator">/</span> renderer<span class="token punctuation">.</span>domElement<span class="token punctuation">.</span>clientWidth<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> y <span class="token operator">=</span> <span class="token operator">-</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>offsetY <span class="token operator">/</span> renderer<span class="token punctuation">.</span>domElement<span class="token punctuation">.</span>clientHeight<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> vector <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// z 可以随意，从而得到的坐标也并不唯一，只是投影的二维坐标一样</span>
  vector<span class="token punctuation">.</span><span class="token function">unproject</span><span class="token punctuation">(</span>camera<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将归一化坐标投射到三维空间坐标中</span>

  <span class="token keyword">return</span> vector<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="三维坐标转换为二维坐标"><a href="#三维坐标转换为二维坐标" class="header-anchor">#</a> 三维坐标转换为二维坐标</h2> <p>在鼠标交互中我们选中了物体很多时候要关联显示一些该物体的相关信息div弹窗等，该弹窗的显示位置需要根据物体的位置来确定，所以就涉及到将物体上的一个三维坐标转换为画布上的二维坐标以确定信息弹窗的定位位置，我们一般选取该物体的中心点作为三维坐标参考点。下面示例代码展示如何获取物体的中心三维坐标点，再得到归一化二维坐标点，最后再计算出画布二维坐标点：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// obj为要获取中心点并转换为画布二维坐标的物体对象</span>
<span class="token keyword">function</span> <span class="token function">get2DPosition</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> box3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Box3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 声明一个包围盒子，用于表示物体的边界，以确定物体中心点</span>
  <span class="token keyword">const</span> vector <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 声明一个三维坐标点，用于保存物体中心点</span>
  
  box3<span class="token punctuation">.</span><span class="token function">setFromObject</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 设置要计算包围盒的来源对象</span>
  <span class="token comment">// 获取包围盒的中心点，该方法本身会返回一个`Vector3`对象，若传入了一个则会将结果拷贝到传入的`Vector3`对象上</span>
  box3<span class="token punctuation">.</span><span class="token function">getCenter</span><span class="token punctuation">(</span>vector<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 不提前声明三维点也可以用：const vector = box3.getCenter(); 新版似乎也要求传入？</span>
  vector<span class="token punctuation">.</span><span class="token function">project</span><span class="token punctuation">(</span>camera<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 将三维坐标转换为画布上归一化的二维坐标</span>

  <span class="token comment">// 转换为画布上的实际二维坐标</span>
  <span class="token keyword">const</span> point <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  point<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token punctuation">(</span>vector <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> renderer<span class="token punctuation">.</span>domElement<span class="token punctuation">.</span>clientWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
  point<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token operator">-</span><span class="token punctuation">(</span>vector <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> renderer<span class="token punctuation">.</span>domElement<span class="token punctuation">.</span>clientHeight <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> point<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="更改物体旋转中心"><a href="#更改物体旋转中心" class="header-anchor">#</a> 更改物体旋转中心</h2> <p>默认情况下，对物体进行旋转时其是绕自身中心旋转的，但有些场景我们需要其绕非自身中心旋转，比如门窗这种应该绕其边缘旋转。一种笨的方案是按默认情况旋转后再偏移到最终结果位置，这种需要计算最后的偏移位置，且起止位置只能一步到位才不会让人察觉是选旋转在偏移，但这就表现不出旋转过程。</p> <p>第二种方案就是更改旋转中心，这样也可以实现过渡效果，但该旋转中心实际也并不是该对象自身的，其原理是：将当前对象放在一个空对象/组中，并把当前对象想要的旋转中心偏移到该空对象的中心位置，此时该对象位置偏移了所以我们将空对象进行相反方向偏移同样的距离使得视觉上当前对象回到原位置，最后旋转该空对象即可，也就相当于改变了原对象的旋转中心，实际该空对象仍然是绕自身中心旋转的。注意，对象放进其他对象/组中后也就作为了其子对象，子对象位置变换也都是相对父对象的。若只是单个网格对象，也可以通过平移其几何体<code>geom.translate(x,y,z)</code>来改变旋转中心(实际改变的几何体的顶点位置从而改变旋转中心)，注意不是平移网格对象。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 参数`obj`为要更改旋转中心的对象，x、y、z 则为新中心的相对坐标偏移量(对于门窗这种大多都是物体宽、高、深度的一半，obj.geometry.boundingBox.parameters.width/2)</span>
<span class="token keyword">function</span> <span class="token function">changePivot</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> parentObj <span class="token operator">=</span> obj<span class="token punctuation">.</span>parent<span class="token punctuation">;</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Object3D</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 或 new THREE.Group()，两者一样</span>
  wrapper<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>position<span class="token punctuation">.</span>x <span class="token operator">+</span> x <span class="token punctuation">,</span> obj<span class="token punctuation">.</span>position<span class="token punctuation">.</span>y <span class="token operator">+</span> y<span class="token punctuation">,</span> obj<span class="token punctuation">.</span>position<span class="token punctuation">.</span>z <span class="token operator">+</span> z<span class="token punctuation">)</span><span class="token punctuation">;</span>
  obj<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span>x<span class="token punctuation">,</span> <span class="token operator">-</span>y<span class="token punctuation">,</span> <span class="token operator">-</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
  wrapper<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
  parentObj<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 需要将`wrapper`添加到`obj`的原父对象中，否则`obj`就相当于被删除了</span>
  <span class="token keyword">return</span> wrapper<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 单个网格的情况</span>
<span class="token keyword">const</span> box <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>BoxGeometry</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
box<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 平移几何体，更改旋转中心</span>
<span class="token keyword">const</span> mesh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>box<span class="token punctuation">,</span> material<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 假设 material 为某材质对象</span>
mesh<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="镜头聚焦到某物体上"><a href="#镜头聚焦到某物体上" class="header-anchor">#</a> 镜头聚焦到某物体上</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// `target`为聚焦目标对象，</span>
<span class="token comment">// `dRate`为相机与对象中心位置的距离应该是其包围盒半径的多少倍，</span>
<span class="token comment">// `direction`为相机位置相对其查看的聚焦对象的方向(向量)</span>
<span class="token keyword">function</span> <span class="token function">focus</span> <span class="token punctuation">(</span>target<span class="token punctuation">,</span> dRate <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> delta <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        
  <span class="token keyword">const</span> box <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Box3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> center <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> radius<span class="token punctuation">;</span>

  box<span class="token punctuation">.</span><span class="token function">setFromObject</span><span class="token punctuation">(</span> target <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>box<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    box<span class="token punctuation">.</span><span class="token function">getCenter</span><span class="token punctuation">(</span>center<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 计算包围盒半径也可采用上面物体居中的方式，即直接用包围盒的尺寸直径，这里是通过包围球获得</span>
    radius <span class="token operator">=</span> box<span class="token punctuation">.</span><span class="token function">getBoundingSphere</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Sphere</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>radius<span class="token punctuation">;</span>

  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// Focusing on an Group, AmbientLight, etc</span>
    center<span class="token punctuation">.</span><span class="token function">setFromMatrixPosition</span><span class="token punctuation">(</span> target<span class="token punctuation">.</span>matrixWorld <span class="token punctuation">)</span><span class="token punctuation">;</span>
    radius <span class="token operator">=</span> camera<span class="token punctuation">.</span>near<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 物体中心位置，再加上该物体大小的倍数作为间距，得到摄像头新位置 </span>
  delta<span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// delta.applyQuaternion( camera.quaternion );</span>
  delta<span class="token punctuation">.</span><span class="token function">multiplyScalar</span><span class="token punctuation">(</span>radius <span class="token operator">*</span> dRate<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// orbit 从原目标位置 到新目标位置，新目标为所聚焦的物体</span>
  <span class="token comment">// const orbitEnd = target.position.clone();</span>
  <span class="token keyword">const</span> orbitEnd <span class="token operator">=</span> center<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 摄像头从原位置 到新位置</span>
  <span class="token keyword">const</span> cameraStart <span class="token operator">=</span> camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> cameraEnd <span class="token operator">=</span> center<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span> delta <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 使用 tween.js 创建补间，实现相机位置逐渐变化的效果，而非一下就到目标位置</span>
  <span class="token keyword">new</span> <span class="token class-name">TWEEN<span class="token punctuation">.</span>Tween</span><span class="token punctuation">(</span>cameraStart<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span>cameraEnd<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">onUpdate</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 改变摄像头位置</span>
    camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>val<span class="token punctuation">.</span>x<span class="token punctuation">,</span> val<span class="token punctuation">.</span>y<span class="token punctuation">,</span> val<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// camera.updateProjectionMatrix();</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">onComplete</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 改变 controls 目标(也就是操作焦点)位置，目的是更改鼠标操作时的参考中心为当前目标物体</span>
    controls<span class="token punctuation">.</span>target<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>orbitEnd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    controls<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="自定义的一些three-js对象上的实用扩展方法"><a href="#自定义的一些three-js对象上的实用扩展方法" class="header-anchor">#</a> 自定义的一些<code>Three.js</code>对象上的实用扩展方法</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 通过物体对象的`name`判断其是否在某个Group组内或是某物体的子对象</span>
<span class="token constant">THREE</span><span class="token punctuation">.</span><span class="token class-name">Object3D</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">isChildOf</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 支持进行正则匹配</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token keyword">instanceof</span> <span class="token class-name">RegExp</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>name<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>name <span class="token operator">===</span> name<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    p <span class="token operator">=</span> p<span class="token punctuation">.</span>parent<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> p<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 修改材质，兼顾多种材质的情况(材质属性值是数组时)</span>
<span class="token comment">// 参数`cb`为传入的修改材质的回调函数，其接受每个材质对象为参数</span>
<span class="token constant">THREE</span><span class="token punctuation">.</span><span class="token class-name">Mesh</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">modifyMaterial</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> material <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>material<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>material <span class="token keyword">instanceof</span> <span class="token class-name">Array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>material <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    material<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">mtl</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> m <span class="token operator">=</span> mtl<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>material<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">cb</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>material <span class="token operator">=</span> material<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>material<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="工具"><a href="#工具" class="header-anchor">#</a> 工具</h2> <p><code>gltf</code>模型压缩，可安装 <a href="https://www.npmjs.com/package/gltf-pipeline" target="_blank" rel="noopener noreferrer">gltf-pipeline 工具<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> -g gltf-pipeline

gltf-pipeline -i input.gltf -o output.glb
gltf-pipeline -i input.gltf -o output.glb -d
</code></pre></div><h2 id="其他"><a href="#其他" class="header-anchor">#</a> 其他</h2> <p>文字转语音播放原生JS-API，<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/SpeechSynthesisUtterance" target="_blank" rel="noopener noreferrer">SpeechSynthesisUtterance<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>加载FBX模型时，模型纹理贴图不显示问题处理，修改<code>FBXLoader.js</code>文件<code>getTexture</code>方法中如下内容：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> texture <span class="token operator">=</span> textureMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span> id <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span> texture<span class="token punctuation">.</span>image <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> texture<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 将上面部分修改为如下，直接返回获取到的纹理贴图</span>
<span class="token keyword">return</span> textureMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span> id <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>获取对象包围盒、包围球、盒子尺寸、中心点</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getBoundingBox</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  obj<span class="token punctuation">.</span><span class="token function">updateMatrixWorld</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> box <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Box3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFromObject</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> size <span class="token operator">=</span> box<span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> center <span class="token operator">=</span> box<span class="token punctuation">.</span><span class="token function">getCenter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> sphere <span class="token operator">=</span> box<span class="token punctuation">.</span><span class="token function">getBoundingSphere</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Sphere</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>box<span class="token punctuation">,</span> sphere<span class="token punctuation">,</span> size<span class="token punctuation">,</span> center<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>玻璃材质不显示：材质的<code>opacity</code>属性数据不合理</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/draw-animation/D3js.html" class="prev">
        D3.js
      </a></span> <span class="next"><a href="/draw-animation/Threejs开发指南/第2章.html">
        第2章 构建Three.js应用的基本组件
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.5bc2a58b.js" defer></script><script src="/assets/js/2.8eecf2bf.js" defer></script><script src="/assets/js/23.366600d7.js" defer></script>
  </body>
</html>
