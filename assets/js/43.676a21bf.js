(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{468:function(t,s,a){"use strict";a.r(s);var n=a(18),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"node模块机制与npm包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#node模块机制与npm包"}},[t._v("#")]),t._v(" Node模块机制与NPM包")]),t._v(" "),a("h2",{attrs:{id:"commonjs规范下的node模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#commonjs规范下的node模块"}},[t._v("#")]),t._v(" CommonJS规范下的Node模块")]),t._v(" "),a("h3",{attrs:{id:"模块编译"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#模块编译"}},[t._v("#")]),t._v(" 模块编译")]),t._v(" "),a("p",[t._v("Node在编译获取的JS文件内容时，对文件内容进行了如下的头尾包装，所以才使得每个模块文件中未定义"),a("code",[t._v("require")]),t._v("、"),a("code",[t._v("exports")]),t._v("、"),a("code",[t._v("module")]),t._v("、"),a("code",[t._v("__filename")]),t._v("、"),a("code",[t._v("__dirname")]),t._v("这几个变量，却能直接使用。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("exports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" require"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" __filename"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" __dirname")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// JS模块文件内容被放在这里...，使得模块文件中可以直接使用上面几个特殊变量")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 我们无需关注其具体如何编译，在模块文件中直接使用即可")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("ul",[a("li",[a("code",[t._v("exports")]),t._v("其实是module的属性也被单独传入可直接使用，但实际导出是反映在module.exports上的，所以一个个导出可使用exports，整体导出则要使用module.exports")]),t._v(" "),a("li",[a("code",[t._v("__filename")]),t._v("为当前模块文件的绝对路径")]),t._v(" "),a("li",[a("code",[t._v("__dirname")]),t._v("为当前模块文件所在目录的绝对路径")])]),t._v(" "),a("h3",{attrs:{id:"模块定义"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#模块定义"}},[t._v("#")]),t._v(" 模块定义")]),t._v(" "),a("p",[t._v("使用"),a("code",[t._v("exports")]),t._v("对象导出当前模块的方法或者变量，且"),a("strong",[t._v("exports是导出的唯一出口")]),t._v("；在模块中，还存在一个"),a("code",[t._v("module")]),t._v("对象，它代表模块自身，而"),a("code",[t._v("exports")]),t._v("是"),a("code",[t._v("module")]),t._v("的属性（这与上面提到的node编译JS模块所做的头尾包装有关，"),a("strong",[t._v("包装时传入的exports就已经是module的属性")]),t._v("）")]),t._v(" "),a("p",[t._v("在node中，一个文件就是一个模块，将方法或变量挂载在"),a("code",[t._v("exports")]),t._v("对象上作为属性即可定义导出的方式。"),a("br"),t._v("\n若要直接整体导出一个已包含全部要导出属性和方法的对象或者类，这时就可以直接对"),a("code",[t._v("module.exports")]),t._v("进行赋值导出该对象或类，因为最终的实际导出本就是要通过 "),a("code",[t._v("module.exports")]),t._v("反映。")]),t._v(" "),a("ul",[a("li",[t._v("我们在添加或修改"),a("code",[t._v("exports")]),t._v("上的属性时，"),a("code",[t._v("exports")]),t._v("对象的引用并未改变，故变化也能反映在"),a("code",[t._v("module.exports")]),t._v("上，从而可正确导出；")]),t._v(" "),a("li",[t._v("但是若直接给"),a("code",[t._v("exports")]),t._v("进行赋值操作时，其引用就发生变化了，因为其实际是node传入的一个形参，形参改变引用并不能改变其原对应实参的引用，所以"),a("code",[t._v("module.exports")]),t._v("并不会变化，也就导致导出会失败；")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* math.js */")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("exports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" require"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" __filename"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" __dirname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// module.exports = {props, methods};   //若要直接导出整个对象或类则就要赋值给 module.exports，而不是 exports")]),t._v("\nexports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("add")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" sum "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" args "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" arguments"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" i"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("len"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("len"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    sum "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" sum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h3",{attrs:{id:"模块引用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#模块引用"}},[t._v("#")]),t._v(" 模块引用")]),t._v(" "),a("p",[t._v("使用 "),a("code",[t._v("require()")]),t._v("方法引入一个外部模块的API到当前上下文中，其参数为模块标识（就是模块文件，也可指定具体文件路径）。node对引入过的模块都会进行缓存，所以再次引入时会优先从缓存中加载，且node不像浏览器是缓存文件，其是缓存编译和执行之后的对象。")]),t._v(" "),a("p",[a("strong",[t._v("模块标识参数类型：")])]),t._v(" "),a("ol",[a("li",[t._v("符合小驼峰命名的字符串（引入的模块会从文件所在位置开始逐级向上查找node_modules文件夹，直到根目录（类似JS中的原型链查找），包括Node自身提供的核心模块和用户自定义模块，其中node核心模块加载时可省略文件定位和编译执行两个步骤，速度是最快的）")]),t._v(" "),a("li",[t._v("以"),a("code",[t._v("./")]),t._v("、"),a("code",[t._v("../")]),t._v("开头的相对路径，或者绝对路径，此类模块为用户编写的文件模块；加载时需要"),a("strong",[t._v("路径分析、文件定位、编译执行")]),t._v("几个过程")])]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("模块标识可以不加文件后缀")]),t._v("，此时node会按.js、.json、.node三种扩展依次尝试加载，所以若是后两种文件可加上扩展名避免浪费性能，若是这三种扩展的文件都未找到而是找到了一个同名目录，则node会将其当做一个包来处理（首先node会在当前目录下查找"),a("code",[t._v("package.json")]),t._v("文件，取出其中"),a("code",[t._v("main")]),t._v("属性指定的文件名进行定位，若文件扩展名省略，则同样按前面的方式进一步判断。若"),a("code",[t._v("main")]),t._v("属性指定的文件名错误，或根本没有"),a("code",[t._v("package.json")]),t._v("文件，则node会将"),a("code",[t._v("index")]),t._v("当做默认文件名继续查找，若仍未找到三种格式之一的任何文件，则node会进入上一层"),a("code",[t._v("node_modules")]),t._v("中继续查找(若该模块只是一个包名，而非路径)，直至根目录仍未找到则会抛出错误）。")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 使用require引入math.js模块，之后math.js模块中定义导出的方法或属性都可以通过math变量访问到（相当于将math.js中的module.exports赋给了math变量）")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" math "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./math'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nmath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h2",{attrs:{id:"包与npm"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#包与npm"}},[t._v("#")]),t._v(" 包与NPM")]),t._v(" "),a("h3",{attrs:{id:"包的基本构成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#包的基本构成"}},[t._v("#")]),t._v(" 包的基本构成")]),t._v(" "),a("p",[t._v("CommonJS的包规范的定义由包结构和包描述文件两个部分组成，前者用于组织包中的各种文件，后者则用于描述包的相关信息，以供外部读取分析。")]),t._v(" "),a("p",[t._v("完全符合CommonJS规范的包目录包含如下文件：")]),t._v(" "),a("ul",[a("li",[t._v("package.json：包描述文件（位于包的根目录下）")]),t._v(" "),a("li",[t._v("bin：用于存放可执行二进制文件的目录")]),t._v(" "),a("li",[t._v("lib：用于存放JavaScript代码的目录")]),t._v(" "),a("li",[t._v("doc：用于存放文档的目录")]),t._v(" "),a("li",[t._v("test：用于存放单元测试用例的代码")])]),t._v(" "),a("p",[t._v("包描述文件用于表达非代码相关的信息，而NPM的所有行为都与包描述文件的字段息息相关，NPM在实践中对CommonJS为package.json文件定义的字段做了一定的取舍，NPM实际用到的字段主要有以下这些：")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("name：")]),t._v(" 报名，需要有小写字母和数字组成，可以包含"),a("code",[t._v(".")]),t._v("、"),a("code",[t._v("_")]),t._v("、"),a("code",[t._v("-")]),t._v("字符，但不允许有空格。包名必须唯一(全网唯一)，且最好不要有node、js这样的标识（因NPM本来就是JS和Node模块的专用包管理工具）")]),t._v(" "),a("li",[a("strong",[t._v("version：")]),t._v(" 包的版本号，一个语义化的版本号，通常为"),a("code",[t._v("major.minor.revision")]),t._v("格式")]),t._v(" "),a("li",[a("strong",[t._v("description：")]),t._v(" 包简介")]),t._v(" "),a("li",[a("strong",[t._v("keywords：")]),t._v(" 关键词数组，NPM中主要用来做分类搜索，便于用户快速查找到我们编写的包")]),t._v(" "),a("li",[a("strong",[t._v("repositories：")]),t._v(" 源代码托管的仓库位置列表")]),t._v(" "),a("li",[a("strong",[t._v("author：")]),t._v(" 包作者")]),t._v(" "),a("li",[a("strong",[t._v("bin：")]),t._v(" 有些包可以作为命令行工具使用，配置好该字段后，通过"),a("code",[t._v("npm install package_name -g")]),t._v("命令可以将脚本添加到执行路径中，之后可以在命令行中直接执行。"),a("code",[t._v("-g")]),t._v("参数表示全局安装，安装一次，所有地方都可使用(无需再安装，除非需要使用指定版本，采用局部安装使用)")]),t._v(" "),a("li",[a("strong",[t._v("main：")]),t._v(" 包的入口文件，在调用"),a("code",[t._v("require()")]),t._v("方法引入该包时，会优先检查该字段，将该字段指定的文件作为其余模块的入口。若不存在该字段，则会依次查找该包根目录下的index.js、index.node、index.json文件作为默认入口")]),t._v(" "),a("li",[a("strong",[t._v("scripts：")]),t._v(" 脚本说明对象，主要被包管理器用来安装、编译、测试、卸载包")]),t._v(" "),a("li",[a("strong",[t._v("engines：")]),t._v(" 支持的JavaScript引擎列表，如node、v8、ejs等(还可指定支持的版本)")]),t._v(" "),a("li",[a("strong",[t._v("dependencies：")]),t._v(" 当前包所需要的依赖包列表，该属性十分重要，NPM会通过该属性自动加载依赖的包")]),t._v(" "),a("li",[a("strong",[t._v("devDependencies：")]),t._v(" 开发依赖包列表。有些包(或模块)只在开发时需要依赖(像一些提高开发效率的工具)，与该包提供的功能无关，打包输出时并不需要，则通过该字段进行配置")])]),t._v(" "),a("h3",{attrs:{id:"包的安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#包的安装"}},[t._v("#")]),t._v(" 包的安装")]),t._v(" "),a("p",[a("strong",[t._v("注意：")]),t._v(" 在执行"),a("code",[t._v("npm install package_name -g")]),t._v("命令进行全局安装时，其并不是将该模块安装为一个全局包的意思，其并不意味着可以从任何地方通过"),a("code",[t._v("require()")]),t._v("来引用它。实际上"),a("code",[t._v("-g")]),t._v("全局模式是将一个包"),a("strong",[t._v("安装为全局可用的可执行命令")]),t._v("，它将包描述文件(package.json)中的"),a("code",[t._v("bin")]),t._v("字段指定的实际可执行脚本文件链接到与node可执行文件相同的路径下。\n事实上，通过全局模式安装的所有模块包都被安装进了一个统一的目录下，这个目录可以通过如下方式推算出来：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("process"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("execPath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'..'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'..'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'lib'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'node_modules'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("如果Node可执行文件的位置是/usr/local/bin/node，那么模块目录就是/usr/local/lib/node_modules。")]),t._v(" "),a("h4",{attrs:{id:"从本地安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#从本地安装"}},[t._v("#")]),t._v(" 从本地安装")]),t._v(" "),a("p",[t._v("对于一些没有发布到NPM上的包，或是因网络原因导致无法直接安装的包，可通过下载到本地进行本地安装，只需为NPM指明package.json文件所在的位置即可：")]),t._v(" "),a("ol",[a("li",[t._v("可以是一个包含package.json的存档文件(tar.gz/zip格式?)；")]),t._v(" "),a("li",[t._v("也可以是一个Url地址；")]),t._v(" "),a("li",[t._v("也可以是一个目录下有package.json文件的目录位置。")])]),t._v(" "),a("h4",{attrs:{id:"从非官方源安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#从非官方源安装"}},[t._v("#")]),t._v(" 从非官方源安装")]),t._v(" "),a("ul",[a("li",[t._v("通过"),a("code",[t._v("--registry")]),t._v("指定安装源："),a("code",[t._v("npm install package_name --registry=某安装源")])]),t._v(" "),a("li",[t._v("若所有包都从镜像源安装，则我们可以配置修改默认安装源，这样就无需在安装每个包时都指定一遍安装源，如我们将默认的官方源"),a("code",[t._v("https://www.npmjs.org")]),t._v("换成淘宝镜像源："),a("code",[t._v("npm config set registry https://registry.npm.taobao.org")]),t._v("，查看当前默认安装源可以命令行"),a("code",[t._v("npm config get registry")])])]),t._v(" "),a("h4",{attrs:{id:"npm钩子命令-对包执行某操作时的钩子"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#npm钩子命令-对包执行某操作时的钩子"}},[t._v("#")]),t._v(" npm钩子命令（对包执行某操作时的钩子）")]),t._v(" "),a("p",[t._v("package.json中scripts字段的提出就是让包在安装或卸载等过程中提供钩子机制，示例如下：")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"scripts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"preinstall"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"preinstall.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"install"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"install.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"uninstall"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"uninstall.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"test"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test.js"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("当在执行"),a("code",[t._v("npm install package_name")]),t._v("时将加载执行preinstall指向的脚本，然后是install指向的脚本；当执行"),a("code",[t._v("npm uninstall package_name")]),t._v("时，uninstall执行的脚本也许会做一些清理工作等；当在一个"),a("strong",[t._v("具体的包目录下执行")]),a("code",[t._v("npm test")]),t._v("时，将会运行test指向的脚本。一个优秀的包应当包含测试用例，并在package.json文件中配置好运行测试的命令，方便用户运行测试用例，以便检验包是否稳定可靠。")]),t._v(" "),a("h4",{attrs:{id:"检索包列表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#检索包列表"}},[t._v("#")]),t._v(" 检索包列表")]),t._v(" "),a("p",[t._v("使用"),a("code",[t._v("npm ls")]),t._v("命令可以分析出当前路径下能够通过模块路径找到的所有npm包，并生成依赖树，类似下面这样：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("├─┬ registry-auth-token@4.2.1\n│ └─┬ rc@1.2.8\n│   ├── deep-extend@0.6.0\n│   ├── ini@1.3.8\n│   ├── minimist@1.2.5 deduped\n│   └── strip-json-comments@2.0.1\n")])])]),a("h3",{attrs:{id:"包的编写发布流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#包的编写发布流程"}},[t._v("#")]),t._v(" 包的编写发布流程")]),t._v(" "),a("p",[t._v("编写的包需要发布到官方源或公司的私有源，已达到与其他人共享的目的。")]),t._v(" "),a("h4",{attrs:{id:"初始化包描述文件-package-json"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#初始化包描述文件-package-json"}},[t._v("#")]),t._v(" 初始化包描述文件(package.json)")]),t._v(" "),a("p",[t._v("在要创建包的目录下执行"),a("code",[t._v("npm init")]),t._v("命令，npm将通过提问式的交互让你逐个填入选项，生成预览的包描述文件，最后会在目录下得到一个package.json文件，暂不确定的选项可以跳过不填，所有内容也可以在生成json文件后再直接手动修改文件(注意应该用main字段指明包的入口文件)。")]),t._v(" "),a("h4",{attrs:{id:"编写包的模块内容"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编写包的模块内容"}},[t._v("#")]),t._v(" 编写包的模块内容")]),t._v(" "),a("p",[t._v("编写相关的模块代码，最后要在入口文件中使用"),a("code",[t._v("exports")]),t._v("或"),a("code",[t._v("module.exports")]),t._v("导出相关的暴露给他人调用的API。")]),t._v(" "),a("h4",{attrs:{id:"登录包仓库-npm-账号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#登录包仓库-npm-账号"}},[t._v("#")]),t._v(" 登录包仓库(npm)账号")]),t._v(" "),a("p",[t._v("不管是官方NPM仓库还是公司的私有NPM仓库，都必须要有对应的仓库账号才允许将包发布到仓库中。使用"),a("code",[t._v("npm adduser [--registry=url]")]),t._v("命令，也可以将"),a("code",[t._v("adduser")]),t._v("换成"),a("code",[t._v("login")]),t._v("(是前者的别名)，执行该命令后按照提示输入用户名等验证信息登录到对应的NPM仓库。可选参数"),a("code",[t._v("--registry")]),t._v("可指定登录的npm源，不指定这位设置中的默认源。另外对应有"),a("code",[t._v("npm logout [--registry=url]")]),t._v("命令退出登录。")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 登录npm仓库")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" adduser "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("--registry"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 或")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" login "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("--registry"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 登出npm仓库")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("logout")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("--registry"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("h4",{attrs:{id:"上传-发布包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#上传-发布包"}},[t._v("#")]),t._v(" 上传/发布包")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 上传/发布包")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" publish "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("folder"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">|")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("tarball"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("--tag "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("tag"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 对应有移除已发布的包")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" unpublish package_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("@"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("tag"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("p",[t._v("参数含义：")]),t._v(" "),a("ul",[a("li",[t._v("folder：一个包含package.json文件的文件夹位置，若就在当前文件夹下则可以直接用"),a("code",[t._v(".")]),t._v("表示："),a("code",[t._v("npm publish .")])]),t._v(" "),a("li",[t._v("tarball：表示也可以是指向一个根目录包含package.json文件的tar格式压缩包的url地址或本地文件路径")]),t._v(" "),a("li",[t._v("可选参数"),a("code",[t._v("--tag")]),t._v("，用于指定当前发布的包的标签(一般跟包的version版本号一直，以用于区分版本)，不指定时默认为"),a("code",[t._v("latest")]),t._v("(最新版)，在根据包名安装时就可以安装指定的版本"),a("code",[t._v("npm install <package_name>@<tag>")]),t._v("，否则就默认安装最新版。")])]),t._v(" "),a("p",[a("strong",[t._v("注意：")]),t._v(" 上传/发布包时，若不存在本地"),a("code",[t._v(".gitignore")]),t._v("或"),a("code",[t._v(".npmignore")]),t._v("文件，则包目录中的所有文件都会上传，否则将忽略这些文件中匹配的文件。但是，若这两个文件都存在，若"),a("code",[t._v(".gitignore")]),t._v("匹配的文件在"),a("code",[t._v(".npmignore")]),t._v("中并未匹配，则该部分文件还是会上传。即："),a("strong",[a("code",[t._v(".npmignore")]),t._v("文件存在则以其为准，若不存在则以"),a("code",[t._v(".gitignore")]),t._v("文件为准")]),t._v("，若都不存在则所有文件都会被上传。")]),t._v(" "),a("h4",{attrs:{id:"包权限管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#包权限管理"}},[t._v("#")]),t._v(" 包权限管理")]),t._v(" "),a("p",[t._v("通常，一个包只有一个人拥有权限进行发布。如果需要多人进行发布，可以使用"),a("code",[t._v("npm owner")]),t._v("命令帮助我们管理包的所有者(只有该包的所有者才有该包的发布权限)：")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 下面的`owner`也可以使用其别名`author`替换，即：npm author ...")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ls 列出对应包的全部所有者")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" owner "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("package_name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# add 添加某人到该包的所有者列表中")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" owner "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("username"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("package_name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# rm 将某人从该包所有者列表中移除")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" owner "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("username"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("package_name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),a("p",[t._v("UMD叫通用模块定义规范，它可以通过运行时或者编译时让同一个代码模块在使用 CommonJs、CMD 甚至是 AMD 的项目中运行，其没有自己的专有规范，只是根据当前环境支持的规范进行判断定义。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" factory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 判断当前环境为什么规范，就按对应的规范进行定义")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typeof")]),t._v(" define "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'function'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" define"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("amd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//AMD")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("define")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'jquery'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" factory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typeof")]),t._v(" exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'object'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//CommonJS")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" $ "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("requie")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'jquery'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("factory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("testModule "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("factory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jQuery"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//todo")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);